(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9296,7217],{6224:function(e,t,n){"use strict";var s,a,r=n(6006);function l(){return(l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}t.Z=function(e){return r.createElement("svg",l({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),s||(s=r.createElement("defs",null,r.createElement("path",{id:"clear_svg__a",d:"M0 0h16v16H0z"}))),r.createElement("g",null,a||(a=r.createElement("mask",{id:"clear_svg__b",fill:"#fff"},r.createElement("use",{xlinkHref:"#clear_svg__a"}))),r.createElement("g",{mask:"url(#clear_svg__b)"},r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M1 9.67h8.67l1-9.67H0l1 9.67Z",transform:"translate(2.667 5)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0v3.33",transform:"translate(6.667 8.334)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0v3.33",transform:"translate(9.334 8.333)"}),r.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"m0 4 5.44-4L8 4",transform:"translate(4 1)"}))))}},1019:function(e,t,n){"use strict";n.r(t),n.d(t,{Chat:function(){return eJ},ChatActions:function(){return eQ},DeleteImageButton:function(){return eG},PromptHints:function(){return eV},ScrollDownToast:function(){return eF},SessionConfigModel:function(){return eB}});var s,a,r,l,i,o,c,m,d,h,u,p,g,f,x,v,_,j,w,y,k,b,C,E=n(9268),S=n(9357),N=n(6006);function P(){return(P=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var M=function(e){return N.createElement("svg",P({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),s||(s=N.createElement("defs",null,N.createElement("path",{id:"share_svg__a",d:"M0 0h16v16H0z"}))),N.createElement("g",null,a||(a=N.createElement("mask",{id:"share_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#share_svg__a"}))),N.createElement("g",{mask:"url(#share_svg__b)"},N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M6.67 3.67C1.67 3.67 0 7.33 0 13c0 0 2-5 6.67-5v3.67l6-5.67-6-6v3.67Z",transform:"translate(2 1.333)"}))))};function Z(){return(Z=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var O=function(e){return N.createElement("svg",Z({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),r||(r=N.createElement("defs",null,N.createElement("path",{id:"send-white_svg__a",d:"M0 0h16v16H0z"}))),N.createElement("g",null,l||(l=N.createElement("mask",{id:"send-white_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#send-white_svg__a"}))),N.createElement("g",{mask:"url(#send-white_svg__b)"},N.createElement("path",{style:{stroke:"#fff",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 4.71 6.67 6l1.67 6.67L12.67 0 0 4.71Z",transform:"translate(1.333 2)"}),N.createElement("path",{style:{stroke:"#fff",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 1.89 1.89 0",transform:"translate(8.003 6.117)"}))))};function H(){return(H=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var T=function(e){return N.createElement("svg",H({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),i||(i=N.createElement("defs",null,N.createElement("path",{id:"rename_svg__a",d:"M0 0h16v16H0z"}))),N.createElement("g",null,o||(o=N.createElement("mask",{id:"rename_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#rename_svg__a"}))),N.createElement("g",{mask:"url(#rename_svg__b)"},N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M2.83 13.2 13.2 2.83 10.37 0 0 10.37v2.83h2.83Z",transform:"translate(1.775 1.3)"}),N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"m0 0 2.83 2.83",transform:"translate(9.317 4.13)"}))))};function I(){return(I=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var D=function(e){return N.createElement("svg",I({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),c||(c=N.createElement("defs",null,N.createElement("path",{id:"export_svg__a",d:"M0 0h16v16H0z"}))),N.createElement("g",null,m||(m=N.createElement("mask",{id:"export_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#export_svg__a"}))),N.createElement("g",{mask:"url(#export_svg__b)"},N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M12.27 9.11a3.09 3.09 0 0 0 1.16-3.44c-.41-1.28-1.65-1.98-2.99-1.98h-.77A4.924 4.924 0 0 0 5.47.03C3.45-.2 1.5.84.56 2.64c-.94 1.81-.67 4 .67 5.53",transform:"translate(1.24 2.333)"}),N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 6V0",transform:"translate(8 7.667)"}),N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M4.24 0 2.12 2.12 0 0",transform:"translate(5.879 11.545)"}))))};function K(){return(K=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var A=function(e){return N.createElement("svg",K({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),d||(d=N.createElement("defs",null,N.createElement("path",{id:"return_svg__a",d:"M0 0h16v16H0z"}))),N.createElement("g",null,h||(h=N.createElement("mask",{id:"return_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#return_svg__a"}))),N.createElement("g",{mask:"url(#return_svg__b)"},N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M2.33 0 0 2l2.33 2.33",transform:"translate(2 2.667)"}),N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0h7.66c2.3 0 4.25 1.87 4.34 4.17.09 2.42-1.91 4.5-4.34 4.5H2",transform:"translate(2 4.667)"}))))},z=n(6011),L=n(359);function W(){return(W=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var F=function(e){return N.createElement("svg",W({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"#fff"},e),u||(u=N.createElement("rect",{width:"100%",height:"100%",fill:"none"})),p||(p=N.createElement("g",{className:"loading_svg__currentLayer"},N.createElement("circle",{cx:4,cy:8,r:1.926,fill:"#333"},N.createElement("animate",{attributeName:"r",begin:"0s",calcMode:"linear",dur:"0.8s",from:2,repeatCount:"indefinite",to:2,values:"2;1.2;2"}),N.createElement("animate",{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"0.8s",from:1,repeatCount:"indefinite",to:1,values:"1;.5;1"})),N.createElement("circle",{cx:8,cy:8,r:1.274,fill:"#333",fillOpacity:.3},N.createElement("animate",{attributeName:"r",begin:"0s",calcMode:"linear",dur:"0.8s",from:1.2,repeatCount:"indefinite",to:1.2,values:"1.2;2;1.2"}),N.createElement("animate",{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"0.8s",from:.5,repeatCount:"indefinite",to:.5,values:".5;1;.5"})),N.createElement("circle",{cx:12,cy:8,r:1.926,fill:"#333"},N.createElement("animate",{attributeName:"r",begin:"0s",calcMode:"linear",dur:"0.8s",from:2,repeatCount:"indefinite",to:2,values:"2;1.2;2"}),N.createElement("animate",{attributeName:"fill-opacity",begin:"0s",calcMode:"linear",dur:"0.8s",from:1,repeatCount:"indefinite",to:1,values:"1;.5;1"})))))};function B(){return(B=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var R=function(e){return N.createElement("svg",B({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),g||(g=N.createElement("defs",null,N.createElement("path",{id:"prompt_svg__a",d:"M0 0h16v16H0z"}))),N.createElement("g",null,f||(f=N.createElement("mask",{id:"prompt_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#prompt_svg__a"}))),N.createElement("g",{mask:"url(#prompt_svg__b)"},N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3,strokeOpacity:1,strokeDasharray:"0 0"},d:"m1.367 1.367 1.41 1.41M4.667 0v2m0 0V0m3.295 1.367-1.41 1.41m0 0 1.41-1.41m1.371 3.3h-2m0 0h2m-1.37 3.295-1.41-1.41m0 0 1.41 1.41M4.666 9.333v-2m0 0v2m-3.3-1.37 1.41-1.41m0 0-1.41 1.41M0 4.666h2m0 0H0",transform:"translate(5.333 1.333)"}),N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M8.01 0 0 8.01",transform:"translate(1.848 6.138)"}))))},V=n(3709),X=n(3506),Y=n(1150);function Q(){return(Q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var G=function(e){return N.createElement("svg",Q({xmlns:"http://www.w3.org/2000/svg",width:16,height:16,fill:"none"},e),N.createElement("path",{style:{fill:"#333",opacity:1},d:"M13.275-.275c.261.26.392.576.392.945v10.66c0 .37-.131.684-.392.945a1.288 1.288 0 0 1-.945.392H1.67c-.37 0-.684-.13-.945-.392a1.288 1.288 0 0 1-.392-.945V.67c0-.37.13-.684.392-.945.26-.261.576-.392.945-.392h10.66c.369 0 .684.13.945.392zM1.667 11.33c0 .002 0 .003.003.003h10.66c.002 0 .003 0 .003-.003V.67c0-.002 0-.003-.003-.003H1.67c-.002 0-.003 0-.003.003z",transform:"translate(1 2)"}),N.createElement("path",{style:{fill:"#333",opacity:1},d:"M9.763 7.507a.666.666 0 0 1-.867 0L7 5.878 5.104 7.506a.665.665 0 0 1-.867.001L2.331 5.878.434 7.506a.66.66 0 0 1-.485.16.66.66 0 0 1-.53-.338.665.665 0 0 1 .147-.834l2.33-2a.666.666 0 0 1 .867 0L4.67 6.123l1.897-1.629a.666.666 0 0 1 .868 0l1.897 1.629 1.906-1.63a.668.668 0 0 1 .867.002l2.33 2a.66.66 0 0 1 .23.455.661.661 0 0 1-.252.575.666.666 0 0 1-.846-.019l-1.897-1.628z",transform:"translate(1 2)"}),x||(x=N.createElement("defs",null,N.createElement("path",{id:"break_svg__a",d:"M0 0h16v16H0z"}))))},U=n(6224),J=n(2137);function q(){return(q=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var $=function(e){return N.createElement("svg",q({xmlns:"http://www.w3.org/2000/svg",fill:"none",height:16,width:16,xmlSpace:"preserve"},e),v||(v=N.createElement("rect",{width:"100%",height:"100%"})),_||(_=N.createElement("g",{className:"image_svg__currentLayer"},N.createElement("g",{fill:"#333"},N.createElement("path",{d:"M2.47 2.47h1.977v-.782H1.688v2.76h.781zM11.553 1.688v.781h1.978v1.978h.78V1.688zM13.53 13.53h-1.977v.782h2.759v-2.76h-.781zM2.47 11.553h-.782v2.759h2.76v-.781H2.468zM8.83 6.243c.682 0 1.237-.555 1.237-1.236S9.512 3.77 8.83 3.77a1.238 1.238 0 0 0 0 2.473zM3.77 12.23h8.46V9.71l-1.527-1.611-1.85 1.077-2.578-1.842L3.77 9.977z"})))))};function ee(){return(ee=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var et=function(e){return N.createElement("svg",ee({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),j||(j=N.createElement("defs",null,N.createElement("path",{id:"bottom_svg__a",d:"M0 0h16v16H0z"}))),N.createElement("g",null,w||(w=N.createElement("mask",{id:"bottom_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#bottom_svg__a"}))),N.createElement("g",{mask:"url(#bottom_svg__b)"},N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M8 0 4 4 0 0",transform:"translate(4 4)"}),N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M8 0 4 4 0 0",transform:"translate(4 8)"}))))};function en(){return(en=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var es=function(e){return N.createElement("svg",en({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),y||(y=N.createElement("defs",null,N.createElement("path",{id:"pause_svg__a",d:"M0 0h16v16H0z"}))),N.createElement("g",null,k||(k=N.createElement("mask",{id:"pause_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#pause_svg__a"}))),N.createElement("g",{mask:"url(#pause_svg__b)"},N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M13.33 6.67A6.66 6.66 0 0 0 6.67 0C2.98 0 0 2.98 0 6.67a6.66 6.66 0 0 0 6.67 6.66c3.68 0 6.66-2.98 6.66-6.66Z",transform:"translate(1.333 1.333)"}),N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0v4",transform:"translate(6.333 6)"}),N.createElement("path",{style:{stroke:"#333",strokeWidth:1.3333333333333333,strokeOpacity:1,strokeDasharray:"0 0"},d:"M0 0v4",transform:"translate(9.667 6)"}))))};function ea(){return(ea=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}var er=function(e){return N.createElement("svg",ea({xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",width:16,height:16,fill:"none"},e),N.createElement("g",null,b||(b=N.createElement("mask",{id:"robot_svg__b",fill:"#fff"},N.createElement("use",{xlinkHref:"#robot_svg__a"}))),N.createElement("g",{mask:"url(#robot_svg__b)"},N.createElement("path",{style:{fill:"#333",opacity:1},d:"M3.67 13.67h8.66c.002 0 .003-.001.003-.003V6.334H3.67c-.002 0-.003 0-.003.003v7.33c0 .002 0 .003.003.003zm0 1.333c-.37 0-.684-.13-.945-.391a1.288 1.288 0 0 1-.392-.945v-7.33c0-.37.13-.685.392-.946.26-.26.576-.391.945-.391h8.66c.37 0 .684.13.945.391.261.261.392.577.392.946v7.33c0 .369-.13.684-.392.945a1.288 1.288 0 0 1-.945.391z"}),N.createElement("path",{style:{fill:"#333",opacity:1},d:"M9.819 6.127a.666.666 0 0 1-1.05-.81l1.67-2.67a.665.665 0 0 1 1.107-.034.663.663 0 0 1 .023.74l-1.67 2.67a.665.665 0 0 1-.08.104zM7.293 5.434a.665.665 0 0 1-1.01.779.665.665 0 0 1-.178-.19l-1.67-2.67a.665.665 0 0 1 .952-.896.665.665 0 0 1 .178.19l1.67 2.67a.665.665 0 0 1 .058.117z"}),N.createElement("path",{style:{fill:"#333",opacity:1},d:"M11.337 2.333c-.003 0-.004.001-.004.004l-.001-.01a.007.007 0 0 0 .005.003h-.007v.007c0-.002 0-.004-.002-.005l.009.001zm0-1.333c.366 0 .679.131.939.394.258.261.387.575.387.943 0 .364-.13.676-.39.936s-.572.39-.936.39c-.368 0-.682-.129-.943-.388A1.273 1.273 0 0 1 10 2.337c0-.37.13-.685.391-.946.262-.26.577-.391.946-.391zM4.67 2.333c-.002 0-.003.001-.003.004 0-.005 0-.008-.002-.01a.007.007 0 0 0 .005.003h-.006v.007c0-.002-.001-.004-.003-.005l.009.001zM4.67 1c.366 0 .679.131.939.394.258.261.388.575.388.943 0 .364-.13.676-.39.936s-.573.39-.937.39c-.367 0-.681-.129-.943-.388a1.273 1.273 0 0 1-.394-.938c0-.37.13-.685.392-.946.26-.26.576-.391.945-.391zM6.663 10.003h2.67c.184 0 .34-.065.469-.194a.655.655 0 0 0 .195-.479.638.638 0 0 0-.196-.467.638.638 0 0 0-.468-.196h-2.67a.638.638 0 0 0-.467.196A.638.638 0 0 0 6 9.33c0 .188.065.347.195.479.128.13.284.194.468.194zm0 1.334a1.974 1.974 0 0 1-1.416-.59 2.001 2.001 0 0 1 1.416-3.413h2.67a1.99 1.99 0 0 1 1.41.587 1.99 1.99 0 0 1 .587 1.409 2.002 2.002 0 0 1-1.997 2.007zM2 10.663h1.003a.666.666 0 1 1 0 1.334h-1.67a.666.666 0 0 1-.666-.667V8a.665.665 0 0 1 .666-.667h1.67a.665.665 0 0 1 .555 1.037.665.665 0 0 1-.555.297H2zM14.8 7.346a.664.664 0 0 1 .537.654v3.33a.666.666 0 0 1-.667.667H13a.666.666 0 1 1 0-1.334h1.003V8.667H13a.665.665 0 0 1-.471-1.138.664.664 0 0 1 .471-.196h1.67c.044 0 .087.005.13.013z"}))),C||(C=N.createElement("defs",null,N.createElement("path",{id:"robot_svg__a",d:"M0 0h16v16H0z"}))))},el=n(9255),ei=n(9881),eo=n(5952),ec=n.n(eo),em=n(3566),ed=n(2416),eh=n(48),eu=n(4461),ep=n.n(eu),eg=n(9319),ef=n(7005),ex=n(2908),ev=n(2174),e_=n(2319),ej=n(4963),ew=n(6963),ey=n.n(ew),ek=n(6155),eb=n(3186),eC=n(5106),eE=n.n(eC);function eS(e){let t=(0,el.aK)(),n=t.currentSession(),s=e=>e.content&&!e.isError&&!e.streaming,a=(0,N.useMemo)(()=>{var e;let t=Math.max(0,null!==(e=n.clearContextIndex)&&void 0!==e?e:0);return t===n.messages.length-1&&(t=0),n.messages.slice(t)},[n.messages,n.clearContextIndex]),r=(0,N.useMemo)(()=>a.filter((e,t)=>e.id&&s(e)&&(t>=a.length-1||s(a[t+1]))),[a]),l=r.length,i=(0,el.MG)(),[o,c]=(0,N.useState)(""),[m,d]=(0,N.useState)(new Set),h=e=>0===o.length||m.has(e),u=e=>{let t=new Set;e.length>0&&r.forEach(n=>(0,ei.YK)(n).includes(e)?t.add(n.id):null),d(t)},{startIndex:p,endIndex:g,onClickIndex:f}=function(){let[e,t]=(0,N.useState)(),[n,s]=(0,N.useState)(),[a,r]=(0,N.useState)(!1);return(0,N.useEffect)(()=>{let e=e=>{"Shift"===e.key&&r(!0)},n=e=>{"Shift"===e.key&&(r(!1),t(void 0),s(void 0))};return window.addEventListener("keyup",n),window.addEventListener("keydown",e),()=>{window.removeEventListener("keyup",n),window.removeEventListener("keydown",e)}},[]),{onClickIndex:n=>{a&&void 0!==e?s(n):(t(n),s(void 0))},startIndex:e,endIndex:n}}(),x=()=>{e.updateSelection(e=>r.forEach(t=>e.add(t.id)))};return(0,N.useEffect)(()=>{e.defaultSelectAll&&x()},[]),(0,N.useEffect)(()=>{if(void 0===p||void 0===g)return;let[t,n]=[p,g].sort((e,t)=>e-t);e.updateSelection(e=>{for(let a=t;a<=n;a+=1){var s;e.add(null!==(s=r[a].id)&&void 0!==s?s:a)}})},[p,g]),(0,E.jsxs)("div",{className:eE()["message-selector"],children:[(0,E.jsxs)("div",{className:eE()["message-filter"],children:[(0,E.jsx)("input",{type:"text",placeholder:ed.ZP.Select.Search,className:eE()["filter-item"]+" "+eE()["search-bar"],value:o,onInput:e=>{c(e.currentTarget.value),u(e.currentTarget.value)}}),(0,E.jsxs)("div",{className:eE().actions,children:[(0,E.jsx)(eh.h,{text:ed.ZP.Select.All,bordered:!0,className:eE()["filter-item"],onClick:x}),(0,E.jsx)(eh.h,{text:ed.ZP.Select.Latest,bordered:!0,className:eE()["filter-item"],onClick:()=>e.updateSelection(e=>{e.clear(),r.slice(l-4).forEach(t=>e.add(t.id))})}),(0,E.jsx)(eh.h,{text:ed.ZP.Select.Clear,bordered:!0,className:eE()["filter-item"],onClick:()=>e.updateSelection(e=>e.clear())})]})]}),(0,E.jsx)("div",{className:eE().messages,children:r.map((t,s)=>{var a;if(!h(t.id))return null;let r=null!==(a=t.id)&&void 0!==a?a:s,l=e.selection.has(r);return(0,E.jsxs)("div",{className:"".concat(eE().message," ").concat(e.selection.has(t.id)&&eE()["message-selected"]),onClick:()=>{e.updateSelection(e=>{e.has(r)?e.delete(r):e.add(r)}),f(s)},children:[(0,E.jsx)("div",{className:eE().avatar,children:"user"===t.role?(0,E.jsx)(ev.qE,{avatar:i.avatar}):(0,E.jsx)(e_.TemplateAvatar,{avatar:n.template.avatar,model:t.model||i.modelConfig.model})}),(0,E.jsxs)("div",{className:eE().body,children:[(0,E.jsx)("div",{className:eE().date,children:new Date(t.date).toLocaleString()}),(0,E.jsx)("div",{className:"".concat(eE().content," one-line"),children:(0,ei.YK)(t)})]}),(0,E.jsx)("div",{className:eE().checkbox,children:(0,E.jsx)("input",{type:"checkbox",checked:l,readOnly:!0})})]},s)})})]})}var eN=n(4262),eP=n(7016);let eM=ec()(async()=>(await Promise.all([n.e(327),n.e(9638),n.e(9015),n.e(2834)]).then(n.bind(n,7291))).Markdown,{loadableGenerated:{webpack:()=>[7291]},loading:()=>(0,E.jsx)(L.Z,{})});function eZ(e){return(0,E.jsx)("div",{className:"screen-model-container",children:(0,E.jsx)(eg.u_,{title:ed.ZP.Export.Title,onClose:e.onClose,footer:(0,E.jsx)("div",{style:{width:"100%",textAlign:"center",fontSize:14,opacity:.5},children:ed.ZP.Exporter.Description.Title}),children:(0,E.jsx)("div",{style:{minHeight:"40vh"},children:(0,E.jsx)(eH,{})})})})}function eO(e){let t=e.steps,n=t.length;return(0,E.jsxs)("div",{className:ey().steps,children:[(0,E.jsx)("div",{className:ey()["steps-progress"],children:(0,E.jsx)("div",{className:ey()["steps-progress-inner"],style:{width:"".concat((e.index+1)/n*100,"%")}})}),(0,E.jsx)("div",{className:ey()["steps-inner"],children:t.map((t,n)=>(0,E.jsxs)("div",{className:"".concat(ey().step," ").concat(ey()[n<=e.index?"step-finished":""]," ").concat(n===e.index&&ey()["step-current"]," clickable"),onClick:()=>{var t;null===(t=e.onStepChange)||void 0===t||t.call(e,n)},role:"button",children:[(0,E.jsx)("span",{className:ey()["step-index"],children:n+1}),(0,E.jsx)("span",{className:ey()["step-name"],children:t.name})]},n))})]})}function eH(){let e=[{name:ed.ZP.Export.Steps.Select,value:"select"},{name:ed.ZP.Export.Steps.Preview,value:"preview"}],{currentStep:t,setCurrentStepIndex:n,currentStepIndex:s}=function(e){let t=e.length,[n,s]=(0,N.useState)(0);return{currentStepIndex:n,setCurrentStepIndex:s,nextStep:()=>s((n+1)%t),prevStep:()=>s((n-1+t)%t),currentStep:e[n]}}(e),[a,r]=(0,N.useState)({format:"image",includeContext:!0});function l(e){let t={...a};e(t),r(t)}let i=(0,el.aK)(),o=i.currentSession(),{selection:c,updateSelection:m}=function(){let[e,t]=(0,N.useState)(new Set);return{selection:e,updateSelection:n=>{let s=new Set(e);n(s),t(s)}}}(),d=(0,N.useMemo)(()=>{let e=[];return a.includeContext&&e.push(...o.template.context),e.push(...o.messages.filter(e=>c.has(e.id))),e},[a.includeContext,o.messages,o.template.context,c]);return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(eO,{steps:e,index:s,onStepChange:n}),(0,E.jsxs)("div",{className:ey()["message-exporter-body"],style:"select"!==t.value?{display:"none"}:{},children:[(0,E.jsxs)(eg.aV,{children:[(0,E.jsx)(eg.HC,{title:ed.ZP.Export.Format.Title,subTitle:ed.ZP.Export.Format.SubTitle,children:(0,E.jsx)(eg.Ph,{value:a.format,onChange:e=>l(t=>t.format=e.currentTarget.value),children:["text","image","json"].map(e=>(0,E.jsx)("option",{value:e,children:e},e))})}),(0,E.jsx)(eg.HC,{title:ed.ZP.Export.IncludeContext.Title,subTitle:ed.ZP.Export.IncludeContext.SubTitle,children:(0,E.jsx)("input",{type:"checkbox",checked:a.includeContext,onChange:e=>{l(t=>t.includeContext=e.currentTarget.checked)}})})]}),(0,E.jsx)(eS,{selection:c,updateSelection:m,defaultSelectAll:!0})]}),"preview"===t.value&&(0,E.jsx)("div",{className:ey()["message-exporter-body"],children:"text"===a.format?(0,E.jsx)(eK,{messages:d,topic:o.topic}):"json"===a.format?(0,E.jsx)(eA,{messages:d,topic:o.topic}):(0,E.jsx)(eD,{messages:d,topic:o.topic})})]})}function eT(e){let[t,n]=(0,N.useState)(!1),s=async()=>{var t;(null===(t=e.messages)||void 0===t?void 0:t.length)&&n(!0)};return(0,E.jsx)(E.Fragment,{children:(0,E.jsxs)("div",{className:ey()["preview-actions"],children:[e.showCopy&&(0,E.jsx)(eh.h,{text:ed.ZP.Export.Copy,bordered:!0,shadow:!0,icon:(0,E.jsx)(z.Z,{}),onClick:e.copy}),(0,E.jsx)(eh.h,{text:ed.ZP.Export.Download,bordered:!0,shadow:!0,icon:(0,E.jsx)(eb.Z,{}),onClick:e.download}),(0,E.jsx)(eh.h,{text:ed.ZP.Export.Share,bordered:!0,shadow:!0,icon:t?(0,E.jsx)(L.Z,{}):(0,E.jsx)(M,{}),onClick:s})]})})}function eI(e){return e.avatar===eP.Vx?(0,E.jsx)("div",{className:"bot-avatar no-dark",children:(0,E.jsx)(ek.Z,{})}):(0,E.jsx)(ev.qE,{avatar:e.avatar})}function eD(e){var t,n;let s=(0,el.aK)(),a=s.currentSession(),r=a.template,l=(0,el.MG)(),i=(0,N.useRef)(null),o=(0,ei.S0)(),c=async()=>{(0,eg.CF)(ed.ZP.Export.Image.Toast);let t=i.current;if(t)try{let n=await (0,eN.YM)(t);if(!n)return;if(o)(0,eg.vi)(n);else{let t=document.createElement("a");t.download="".concat(e.topic,".png"),t.href=n,t.click(),m()}}catch(e){(0,eg.CF)(ed.ZP.Download.Failed)}},m=()=>{let e=i.current;e&&(e.innerHTML=e.innerHTML)};return(0,E.jsxs)("div",{className:ey()["image-previewer"],children:[(0,E.jsx)(eT,{copy:()=>{(0,eg.CF)(ed.ZP.Export.Image.Toast);let e=i.current;e&&(0,eN.SE)(e).then(e=>{if(e)try{navigator.clipboard.write([new ClipboardItem({"image/png":e})]).then(()=>{(0,eg.CF)(ed.ZP.Copy.Success),m()})}catch(e){console.error("[Copy Image] ",e),(0,eg.CF)(ed.ZP.Copy.Failed)}})},download:c,showCopy:!o,messages:e.messages}),(0,E.jsxs)("div",{className:"".concat(ey()["preview-body"]," ").concat(ey()["default-theme"]),ref:i,children:[(0,E.jsxs)("div",{className:ey()["chat-info"],children:[(0,E.jsx)("div",{className:ey().logo+" no-dark",children:(0,E.jsx)(ek.Z,{})}),(0,E.jsxs)("div",{children:[(0,E.jsx)("div",{className:ey()["main-title"],children:"WebLLM Chat"}),(0,E.jsx)("div",{className:ey()["sub-title"],children:window.location.host})]}),(0,E.jsxs)("div",{children:[(0,E.jsxs)("div",{className:ey()["chat-info-item"],children:[ed.ZP.Exporter.Model,": ",l.modelConfig.model]}),(0,E.jsxs)("div",{className:ey()["chat-info-item"],children:[ed.ZP.Exporter.Messages,": ",e.messages.length]}),(0,E.jsxs)("div",{className:ey()["chat-info-item"],children:[ed.ZP.Exporter.Topic,": ",a.topic]}),(0,E.jsxs)("div",{className:ey()["chat-info-item"],children:[ed.ZP.Exporter.Time,":"," ",new Date(null!==(n=null===(t=e.messages.at(-1))||void 0===t?void 0:t.date)&&void 0!==n?n:Date.now()).toLocaleString()]})]})]}),e.messages.map((e,t)=>(0,E.jsxs)("div",{className:ey().message+" "+ey()["message-"+e.role],children:["user"!==e.role&&(0,E.jsx)("div",{className:ey().avatar,children:(0,E.jsx)(eI,{avatar:r.avatar})}),(0,E.jsxs)("div",{className:ey().body,children:[(0,E.jsx)(eM,{content:(0,ei.YK)(e),fontSize:l.fontSize,defaultShow:!0}),1==(0,ei.Bs)(e).length&&(0,E.jsx)("img",{src:(0,ei.Bs)(e)[0],alt:"message",className:ey()["message-image"]},t),(0,ei.Bs)(e).length>1&&(0,E.jsx)("div",{className:ey()["message-images"],style:{"--image-count":(0,ei.Bs)(e).length},children:(0,ei.Bs)(e).map((e,t)=>(0,E.jsx)("img",{src:e,alt:"message",className:ey()["message-image-multi"]},t))})]})]},t))]})]})}function eK(e){let t="# ".concat(e.topic,"\n\n")+e.messages.map(e=>"user"===e.role?"## ".concat(ed.ZP.Export.MessageFromYou,":\n").concat((0,ei.YK)(e)):"## ".concat(ed.ZP.Export.MessageFromWebLLM,":\n").concat((0,ei.YK)(e).trim())).join("\n\n");return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(eT,{copy:()=>{(0,ei.vQ)(t)},download:()=>{(0,ei.CP)(t,"".concat(e.topic,".md"))},showCopy:!0,messages:e.messages}),(0,E.jsx)("div",{className:"markdown-body",children:(0,E.jsx)("pre",{className:ey()["export-content"],children:t})})]})}function eA(e){let t={messages:[{role:"system",content:"".concat(ed.ZP.FineTuned.Sysmessage," ").concat(e.topic)},...e.messages.map(e=>({role:e.role,content:e.content}))]},n="```json\n"+JSON.stringify(t,null,2)+"\n```",s=JSON.stringify(t),a=()=>{(0,ei.vQ)(s)};return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(eT,{copy:a,download:()=>{(0,ei.CP)(JSON.stringify(t),"".concat(e.topic,".json"))},showCopy:!1,messages:e.messages}),(0,E.jsx)("div",{className:"markdown-body",onClick:a,children:(0,E.jsx)(eM,{content:n})})]})}var ez=n(6394),eL=n.n(ez),eW=n(6598);function eF(e){return(0,E.jsx)("div",{className:ep()["toast-container"]+(e.show?" ".concat(ep().show):""),children:(0,E.jsx)("div",{className:ep()["toast-content"],onClick:()=>e.onclick(),children:(0,E.jsx)(et,{})})})}function eB(e){let[t,n]=(0,N.useState)(!1),s=(0,el.MG)(),a=(0,el.aK)(),r=a.currentSession(),l=(0,eP.dk)(),i=(0,ef.s0)(),o=e=>{let t={...r.template};e(t),a.updateCurrentSession(e=>e.template=t)};return(0,E.jsx)("div",{className:"screen-model-container",children:(0,E.jsxs)(eg.u_,{title:ed.ZP.Context.Edit,onClose:()=>e.onClose(),actions:[(0,E.jsx)(eh.h,{icon:(0,E.jsx)(Y.Z,{}),bordered:!0,text:ed.ZP.Chat.Config.Reset,onClick:async()=>{await (0,eg.i0)(ed.ZP.Memory.ResetConfirm)&&a.updateCurrentSession(e=>e.memoryPrompt="")}},"reset"),(0,E.jsx)(eh.h,{icon:(0,E.jsx)(z.Z,{}),bordered:!0,text:ed.ZP.Chat.Config.SaveAs,onClick:()=>{(0,eg.G5)(ed.ZP.Template.Config.Name,r.topic,1).then(e=>{o(t=>{t.name=e}),i(ex.y$.Templates),setTimeout(()=>{l.create(r.template)},500)})}},"copy"),(0,E.jsx)(eh.h,{type:"primary",icon:(0,E.jsx)(J.Z,{}),bordered:!0,text:ed.ZP.Chat.Config.Confirm,onClick:e.onClose},"ok")],children:[(0,E.jsx)(e_.ContextPrompts,{context:r.template.context,updateContext:e=>{let t=r.template.context.slice();e(t),o(e=>e.context=t)}}),(0,E.jsxs)(eg.aV,{children:[(0,E.jsx)(eg.HC,{title:ed.ZP.Chat.EditMessage.Topic.Title,subTitle:ed.ZP.Chat.EditMessage.Topic.SubTitle,children:(0,E.jsx)("input",{type:"text",value:r.topic,onInput:e=>a.updateCurrentSession(t=>t.topic=e.currentTarget.value)})}),(0,E.jsx)(eg.HC,{title:ed.ZP.Template.Config.Avatar,children:(0,E.jsx)(eg.J2,{content:(0,E.jsx)(ev.aR,{onEmojiClick:e=>{o(t=>t.avatar=e),n(!1)}}),open:t,onClose:()=>n(!1),children:(0,E.jsx)("div",{onClick:()=>n(!0),style:{cursor:"pointer"},children:(0,E.jsx)(e_.TemplateAvatar,{avatar:r.template.avatar,model:s.modelConfig.model})})})}),(0,E.jsx)(eg.HC,{title:ed.ZP.Template.Config.HideContext.Title,subTitle:ed.ZP.Template.Config.HideContext.SubTitle,children:(0,E.jsx)("input",{type:"checkbox",checked:r.template.hideContext,onChange:e=>{o(t=>{t.hideContext=e.currentTarget.checked})}})})]})]})})}let eR=ec()(async()=>(await Promise.all([n.e(327),n.e(9638),n.e(9015),n.e(2834)]).then(n.bind(n,7291))).Markdown,{loadableGenerated:{webpack:()=>[7291]},loading:()=>(0,E.jsx)(L.Z,{})});function eV(e){let t=0===e.prompts.length,[n,s]=(0,N.useState)(0),a=(0,N.useRef)(null);return((0,N.useEffect)(()=>{s(0)},[e.prompts.length]),(0,N.useEffect)(()=>{let r=r=>{if(t||r.metaKey||r.altKey||r.ctrlKey)return;let l=t=>{var l;r.stopPropagation(),r.preventDefault();let i=Math.max(0,Math.min(e.prompts.length-1,n+t));s(i),null===(l=a.current)||void 0===l||l.scrollIntoView({block:"center"})};if("ArrowUp"===r.key)l(1);else if("ArrowDown"===r.key)l(-1);else if("Enter"===r.key){let t=e.prompts.at(n);t&&e.onPromptSelect(t)}};return window.addEventListener("keydown",r),()=>window.removeEventListener("keydown",r)},[e.prompts.length,n]),t)?null:(0,E.jsx)("div",{className:ep()["prompt-hints"],children:e.prompts.map((t,r)=>(0,E.jsxs)("div",{ref:r===n?a:null,className:ep()["prompt-hint"]+" ".concat(r===n?ep()["prompt-hint-selected"]:""),onClick:()=>e.onPromptSelect(t),onMouseEnter:()=>s(r),children:[(0,E.jsx)("div",{className:ep()["hint-title"],children:t.title}),(0,E.jsx)("div",{className:ep()["hint-content"],children:t.content})]},t.title+r.toString()))})}function eX(){let e=(0,el.aK)();return(0,E.jsxs)("div",{className:ep()["clear-context"],onClick:()=>e.updateCurrentSession(e=>e.clearContextIndex=void 0),children:[(0,E.jsx)("div",{className:ep()["clear-context-tips"],children:ed.ZP.Context.Clear}),(0,E.jsx)("div",{className:ep()["clear-context-revert-btn"],children:ed.ZP.Context.Revert})]})}function eY(e){let t=(0,N.useRef)(null),n=(0,N.useRef)(null),[s,a]=(0,N.useState)({full:16,icon:16});function r(){if(!t.current||!n.current)return;let e=n.current.getBoundingClientRect().width,s=t.current.getBoundingClientRect().width;a({full:e+s,icon:s})}return e.fullWidth?(0,E.jsxs)("div",{className:"".concat(ep()["chat-input-action"]," clickable ").concat(ep()["full-width"]),onClick:e.onClick,children:[(0,E.jsx)("div",{ref:t,className:ep().icon,children:e.icon}),(0,E.jsx)("div",{className:ep().text,ref:n,children:e.text})]}):(0,E.jsxs)("div",{className:"".concat(ep()["chat-input-action"]," clickable"),onClick:()=>{e.onClick(),setTimeout(r,1)},onMouseEnter:r,onTouchStart:r,style:{"--icon-width":"".concat(s.icon,"px"),"--full-width":"".concat(s.full,"px")},children:[(0,E.jsx)("div",{ref:t,className:ep().icon,children:e.icon}),(0,E.jsx)("div",{className:ep().text,ref:n,children:e.text})]})}function eQ(e){let t=(0,el.MG)(),n=(0,el.aK)(),s=t.modelConfig.model,a=t.models,[r,l]=(0,N.useState)(!1),[i,o]=(0,N.useState)(!1);return(0,N.useEffect)(()=>{let t=(0,ei.Xf)(s);o(t),t||(e.setAttachImages([]),e.setUploading(!1))},[n,s,a]),(0,E.jsxs)("div",{className:ep()["chat-input-actions"],children:[i&&(0,E.jsx)(eY,{onClick:e.uploadImage,text:ed.ZP.Chat.InputActions.UploadImage,icon:e.uploading?(0,E.jsx)(F,{}):(0,E.jsx)($,{})}),(0,E.jsx)(eY,{onClick:e.showPromptSetting,text:ed.ZP.Chat.Actions.EditPrompts,icon:(0,E.jsx)(T,{})}),(0,E.jsx)(eY,{onClick:e.showPromptHints,text:ed.ZP.Chat.InputActions.QuickPrompt,icon:(0,E.jsx)(R,{})}),(0,E.jsx)(eY,{text:ed.ZP.Chat.InputActions.Clear,icon:(0,E.jsx)(G,{}),onClick:()=>{n.updateCurrentSession(e=>{e.clearContextIndex===e.messages.length?e.clearContextIndex=void 0:(e.clearContextIndex=e.messages.length,e.memoryPrompt="")})}}),(0,E.jsx)(eY,{onClick:()=>l(!0),text:s,icon:(0,E.jsx)(er,{}),fullWidth:!0}),r&&(0,E.jsx)(eg.Qf,{defaultSelectedValue:s,items:a.map(e=>({title:e.name,value:e.name,family:e.family})),onClose:()=>l(!1),onSelection:e=>{0!==e.length&&(t.selectModel(e[0]),(0,eg.CF)(e[0]))}})]})}function eG(e){return(0,E.jsx)("div",{className:ep()["delete-image"],onClick:e.deleteImage,children:(0,E.jsx)(U.Z,{})})}function eU(){var e,t;let n=(0,el.aK)(),s=n.currentSession(),a=(0,el.MG)(),r=a.fontSize,l=s.messages.some(e=>e.streaming),[i,o]=(0,N.useState)(!1),c=(0,N.useRef)(null),[m,d]=(0,N.useState)(""),{submitKey:h,shouldSubmit:u}=function(){let e=(0,el.MG)(),t=e.submitKey,n=(0,N.useRef)(!1);return(0,N.useEffect)(()=>{let e=()=>{n.current=!0},t=()=>{n.current=!1};return window.addEventListener("compositionstart",e),window.addEventListener("compositionend",t),()=>{window.removeEventListener("compositionstart",e),window.removeEventListener("compositionend",t)}},[]),{submitKey:t,shouldSubmit:t=>229!=t.keyCode&&"Enter"===t.key&&("Enter"!==t.key||!t.nativeEvent.isComposing&&!n.current)&&(e.submitKey===el.mQ.AltEnter&&t.altKey||e.submitKey===el.mQ.CtrlEnter&&t.ctrlKey||e.submitKey===el.mQ.ShiftEnter&&t.shiftKey||e.submitKey===el.mQ.MetaEnter&&t.metaKey||e.submitKey===el.mQ.Enter&&!t.altKey&&!t.ctrlKey&&!t.shiftKey&&!t.metaKey)}}(),p=(0,N.useRef)(null),g=null!=p&&!!p.current&&1>=Math.abs(p.current.scrollHeight-(p.current.scrollTop+p.current.clientHeight)),{setAutoScroll:f,scrollDomToBottom:x}=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],[n,s]=(0,N.useState)(!0);function a(){let t=e.current;t&&requestAnimationFrame(()=>{s(!0),t.scrollTo(0,t.scrollHeight)})}return(0,N.useEffect)(()=>{n&&!t&&a()}),{scrollRef:e,autoScroll:n,setAutoScroll:s,scrollDomToBottom:a}}(p,g),[v,_]=(0,N.useState)(!0),j=(0,ei.S0)(),w=(0,ef.s0)(),[y,k]=(0,N.useState)([]),[b,C]=(0,N.useState)(!1),[P,Z]=(0,N.useState)(!1),H=(0,N.useContext)(eW.J),I=(0,N.useContext)(eW.R),K=a.modelClientType===el._P.MLCLLM_API?I:H,L=a.models,W=(0,em.f)(),[F,B]=(0,N.useState)([]),R=(0,S.y1)(e=>{let t=W.search(e);B(t)},100,{leading:!0,trailing:!0}),[Q,G]=(0,N.useState)(2),J=(0,S.y1)(()=>{let e=c.current?(0,ei.lx)(c.current):1,t=Math.min(20,Math.max(2+Number(!j),e));G(t)},100,{leading:!0,trailing:!0});(0,N.useEffect)(J,[m]);let q=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};function t(e){return e.startsWith(":")?e.slice(1):e}return{match:function(n){let s=t(n),a="function"==typeof e[s];return{matched:a,invoke:()=>a&&e[s](n)}},search:function(n){let s=t(n),a=ed.ZP.Chat.Commands;return Object.keys(e).filter(e=>e.startsWith(s)).map(e=>({title:a[e],content:":"+e}))}}}({new:()=>n.newSession(),prev:()=>n.nextSession(-1),next:()=>n.nextSession(1),clear:()=>n.updateCurrentSession(e=>e.clearContextIndex=e.messages.length),del:()=>n.deleteSession(n.currentSessionIndex)}),$=e=>{d(e);let t=e.trim().length;0===t?B([]):e.startsWith(":")?B(q.search(e)):!a.disablePromptHint&&t<30&&e.startsWith("/")&&R(e.slice(1))},ee=e=>{var t;if(""===e.trim())return;let s=q.match(e);if(s.matched){d(""),B([]),s.invoke();return}l||(n.onUserInput(e,K,y),k([]),localStorage.setItem(ex.Sb,e),d(""),B([]),j||null===(t=c.current)||void 0===t||t.focus(),f(!0))},et=()=>{K.abort(),n.stopStreaming()};(0,N.useEffect)(()=>{n.resetGeneratingStatus()},[]),(0,N.useEffect)(()=>{n.updateCurrentSession(e=>{let t=Date.now()-ex.tb;e.messages.forEach(e=>{(e.isError||new Date(e.date).getTime()<t)&&(e.streaming&&(e.streaming=!1),0===e.content.length&&(e.isError=!0,e.content=function(e){let t=e;return("string"!=typeof e&&(e=JSON.stringify(e,null,"  ")),"{}"===e)?t.toString():e.startsWith("```json")?e:["```json",e,"```"].join("\n")}({error:!0,message:"empty response"})))}),e.messages=e.messages.filter(e=>e.content.length>0)})},[]);let en=(e,t)=>{(0,ei.Ri)(e.currentTarget,(0,ei.YK)(t))&&(0===m.length&&d((0,ei.YK)(t)),e.preventDefault())},ea=e=>{n.updateCurrentSession(t=>t.messages=t.messages.filter(t=>t.id!==e))},er=e=>{ea(e)},eo=e=>{var t,a;let r,l;let i=s.messages.findIndex(t=>t.id===e.id);if(i<0||i>=s.messages.length){console.error("[Chat] failed to find resending message",e);return}if("assistant"===e.role){l=e;for(let e=i;e>=0;e-=1)if("user"===s.messages[e].role){r=s.messages[e];break}}else if("user"===e.role){r=e;for(let e=i;e<s.messages.length;e+=1)if("assistant"===s.messages[e].role){l=s.messages[e];break}}if(void 0===r){console.error("[Chat] failed to resend",e);return}ea(r.id),ea(null===(t=l)||void 0===t?void 0:t.id);let o=(0,ei.YK)(r),m=(0,ei.Bs)(r);n.onUserInput(o,K,m),null===(a=c.current)||void 0===a||a.focus()},ec=(0,N.useMemo)(()=>s.template.hideContext?[]:s.template.context.slice(),[s.template.context,s.template.hideContext]);if(0===ec.length&&(null===(e=s.messages.at(0))||void 0===e?void 0:e.content)!==el.ux.content){let e=Object.assign({},el.ux);ec.push(e)}let eu=(0,N.useMemo)(()=>ec.concat(s.messages).concat(m.length>0&&a.sendPreviewBubble?[{...(0,el.tn)({role:"user",content:m}),preview:!0}]:[]),[a.sendPreviewBubble,ec,s.messages,s.messages.length,m]),[ew,ey]=(0,N.useState)(Math.max(0,eu.length-ex.nS));function ek(e){ey(e=Math.max(0,e=Math.min(eu.length-ex.nS,e)))}let eb=(0,N.useMemo)(()=>{let e=Math.min(ew+3*ex.nS,eu.length);return eu.slice(ew,e)},[ew,eu]),eC=e=>{let t=e.scrollTop+e.clientHeight,n=e.clientHeight,s=e.scrollTop<=n,a=t>=e.scrollHeight-n,r=t>=e.scrollHeight-(j?4:10),l=ew-ex.nS,i=ew+ex.nS;s&&!a?ek(l):a&&ek(i),_(r),f(r)};function eE(){ek(eu.length-ex.nS),x()}let eS=(null!==(t=s.clearContextIndex)&&void 0!==t?t:-1)>=0?s.clearContextIndex+ec.length-ew:-1;!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},[t,n]=(0,ej.lr)();(0,N.useEffect)(()=>{let s=!1;t.forEach((n,a)=>{"function"==typeof e[a]&&(e[a](n),t.delete(a),s=!0)}),s&&n(t)},[t,e])}({fill:d,submit:e=>{ee(e)}}),(0,N.useEffect)(()=>{let e=(0,ex.AI)(s.id),t=localStorage.getItem(e);t&&0===m.length&&(d(t),localStorage.removeItem(e));let n=c.current;return()=>{var t;localStorage.setItem(e,null!==(t=null==n?void 0:n.value)&&void 0!==t?t:"")}},[]);let eN=(0,N.useCallback)(async e=>{let t=a.modelConfig.model;if(!(0,ei.Xf)(t))return;let n=e.clipboardData.items||await navigator.clipboard.read();for(let t of n)if("file"===t.kind&&t.type.startsWith("image/")){e.preventDefault();let n=t.getAsFile();if(n){let e=[];e.push(...y),e.push(...await new Promise((e,t)=>{C(!0);let s=[];(0,ei.hv)(n,262144).then(t=>{s.push(t),C(!1),e(s)}).catch(e=>{C(!1),t(e)})}));let t=e.length;t>3&&e.splice(3,t-3),k(e)}}},[y,n]);async function eP(){let e=[];e.push(...y),e.push(...await new Promise((e,t)=>{let n=document.createElement("input");n.type="file",n.accept="image/png, image/jpeg, image/webp, image/heic, image/heif",n.multiple=!0,n.onchange=n=>{C(!0);let s=n.target.files,a=[];for(let r=0;r<s.length;r++){let l=n.target.files[r];(0,ei.hv)(l,262144).then(t=>{a.push(t),(3===a.length||a.length===s.length)&&(C(!1),e(a))}).catch(e=>{C(!1),t(e)})}},n.click()}));let t=e.length;t>3&&e.splice(3,t-3),k(e)}return(0,E.jsxs)("div",{className:ep().chat,children:[(0,E.jsxs)("div",{className:"window-header",children:[j&&(0,E.jsx)("div",{className:"window-actions",children:(0,E.jsx)("div",{className:"window-action-button",children:(0,E.jsx)(eh.h,{icon:(0,E.jsx)(A,{}),bordered:!0,title:ed.ZP.Chat.Actions.ChatList,onClick:()=>w(ex.y$.Home)})})}),(0,E.jsxs)("div",{className:"window-header-title ".concat(ep()["chat-body-title"]),children:[(0,E.jsx)("div",{className:"window-header-main-title ".concat(ep()["chat-body-main-title"]),onClickCapture:()=>Z(!0),children:s.topic?s.topic:el.HX}),(0,E.jsx)("div",{className:"window-header-sub-title",children:ed.ZP.Chat.SubTitle(s.messages.length)})]}),(0,E.jsxs)("div",{className:"window-actions",children:[!j&&(0,E.jsx)("div",{className:"window-action-button",children:(0,E.jsx)(eh.h,{icon:(0,E.jsx)(T,{}),bordered:!0,onClick:()=>Z(!0)})}),(0,E.jsx)("div",{className:"window-action-button",children:(0,E.jsx)(eh.h,{icon:(0,E.jsx)(M,{}),bordered:!0,title:ed.ZP.Chat.Actions.Share,onClick:()=>{let e=new URLSearchParams({model:a.modelConfig.model,temperature:a.modelConfig.temperature.toString(),top_p:a.modelConfig.top_p.toString(),max_tokens:a.modelConfig.max_tokens.toString(),presence_penalty:a.modelConfig.presence_penalty.toString(),frequency_penalty:a.modelConfig.frequency_penalty.toString()}),t=new URL("".concat(window.location.origin).concat(window.location.pathname,"?").concat(e));(0,ei.vQ)(t.href)}})}),(0,E.jsx)("div",{className:"window-action-button",children:(0,E.jsx)(eh.h,{icon:(0,E.jsx)(D,{}),bordered:!0,title:ed.ZP.Chat.Actions.Export,onClick:()=>{o(!0)}})}),!j&&(0,E.jsx)("div",{className:"window-action-button",children:(0,E.jsx)(eh.h,{icon:a.tightBorder?(0,E.jsx)(X.Z,{}):(0,E.jsx)(V.Z,{}),bordered:!0,onClick:()=>{a.update(e=>e.tightBorder=!e.tightBorder)}})})]})]}),(0,E.jsxs)("div",{className:ep()["chat-body"],ref:p,onScroll:e=>eC(e.currentTarget),onMouseDown:()=>{var e;return null===(e=c.current)||void 0===e?void 0:e.blur()},onTouchStart:()=>{var e;null===(e=c.current)||void 0===e||e.blur(),f(!1)},children:[(0,E.jsx)("div",{className:ep()["chat-action-context"],children:(0,E.jsx)(eY,{text:ed.ZP.Chat.Actions.EditPrompts,icon:(0,E.jsx)(T,{}),onClick:()=>Z(!0),fullWidth:!0})}),eb.map((e,t)=>{var l;let i="user"===e.role,o=t<ec.length,c=t>0&&!(e.preview||0===e.content.length)&&!o,m=e.preview||e.streaming,h=t===eS-1;return(0,E.jsxs)(N.Fragment,{children:[(0,E.jsx)("div",{className:i?ep()["chat-message-user"]:ep()["chat-message"],children:(0,E.jsxs)("div",{className:ep()["chat-message-container"],children:[(0,E.jsxs)("div",{className:ep()["chat-message-header"],children:[(0,E.jsx)("div",{className:ep()["chat-message-avatar"],children:!i&&(0,E.jsx)(E.Fragment,{children:["system"].includes(e.role)?(0,E.jsx)(ev.qE,{avatar:"2699-fe0f"}):(0,E.jsx)(e_.TemplateAvatar,{avatar:s.template.avatar,model:e.model||a.modelConfig.model})})}),(0,E.jsxs)("div",{className:ep()["chat-message-role-name-container"],children:["system"===e.role&&(0,E.jsx)("div",{className:"".concat(ep()["chat-message-role-name"]," ").concat(ep()["no-hide"]),children:ed.ZP.Chat.Roles.System}),"assistant"===e.role&&(0,E.jsx)("div",{className:ep()["chat-message-role-name"],children:L.find(t=>t.name===e.model)?L.find(t=>t.name===e.model).display_name:e.model}),c&&(0,E.jsx)("div",{className:ep()["chat-message-actions"],children:(0,E.jsxs)("div",{className:ep()["chat-input-actions"],children:[(0,E.jsx)(eY,{text:ed.ZP.Chat.Actions.Edit,icon:(0,E.jsx)(T,{}),onClick:async()=>{let t=await (0,eg.G5)(ed.ZP.Chat.Actions.Edit,(0,ei.YK)(e),10),s=t,a=(0,ei.Bs)(e);if(a.length>0){s=[{type:"text",text:t}];for(let e=0;e<a.length;e++)s.push({type:"image_url",image_url:{url:a[e]}})}n.updateCurrentSession(t=>{let n=t.template.context.concat(t.messages).find(t=>t.id===e.id);n&&(n.content=s)})}}),e.streaming?(0,E.jsx)(eY,{text:ed.ZP.Chat.Actions.Stop,icon:(0,E.jsx)(es,{}),onClick:()=>et()}):(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(eY,{text:ed.ZP.Chat.Actions.Retry,icon:(0,E.jsx)(Y.Z,{}),onClick:()=>eo(e)}),(0,E.jsx)(eY,{text:ed.ZP.Chat.Actions.Delete,icon:(0,E.jsx)(U.Z,{}),onClick:()=>er(null!==(l=e.id)&&void 0!==l?l:t)}),(0,E.jsx)(eY,{text:ed.ZP.Chat.Actions.Copy,icon:(0,E.jsx)(z.Z,{}),onClick:()=>(0,ei.vQ)((0,ei.YK)(e))})]})]})})]})]}),m&&(0,E.jsx)("div",{className:ep()["chat-message-status"],children:ed.ZP.Chat.Typing}),(0,E.jsxs)("div",{className:ep()["chat-message-item"],children:[(0,E.jsx)(eR,{content:(0,ei.YK)(e),loading:(e.preview||e.streaming)&&0===e.content.length&&!i,onContextMenu:t=>en(t,e),onDoubleClickCapture:()=>{j&&d((0,ei.YK)(e))},fontSize:r,parentRef:p,defaultShow:t>=eb.length-6}),1==(0,ei.Bs)(e).length&&(0,E.jsx)(eL(),{className:ep()["chat-message-item-image"],src:(0,ei.Bs)(e)[0],alt:""}),(0,ei.Bs)(e).length>1&&(0,E.jsx)("div",{className:ep()["chat-message-item-images"],style:{"--image-count":(0,ei.Bs)(e).length},children:(0,ei.Bs)(e).map((e,t)=>(0,E.jsx)(eL(),{className:ep()["chat-message-item-image-multi"],src:e,alt:""},t))})]}),(0,E.jsxs)("div",{className:ep()["chat-message-action-date"],children:["assistant"===e.role&&e.usage&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)("div",{children:"Prefill: ".concat(e.usage.extra.prefill_tokens_per_s.toFixed(1)," tok/s,")}),(0,E.jsx)("div",{children:"Decode: ".concat(e.usage.extra.decode_tokens_per_s.toFixed(1)," tok/s,")})]}),(0,E.jsx)("div",{children:o?ed.ZP.Chat.IsContext:e.date.toLocaleString()})]})]})}),h&&(0,E.jsx)(eX,{})]},"".concat(t,"/").concat(e.id))})]}),(0,E.jsxs)("div",{className:ep()["chat-input-panel"],children:[(0,E.jsx)(eF,{onclick:eE,show:!v}),(0,E.jsx)(eV,{prompts:F,onPromptSelect:e=>{setTimeout(()=>{var t;B([]);let n=q.match(e.content);n.matched?(n.invoke(),d("")):d(e.content),null===(t=c.current)||void 0===t||t.focus()},30)}}),(0,E.jsx)(eQ,{uploadImage:eP,setAttachImages:k,setUploading:C,scrollToBottom:eE,hitBottom:v,uploading:b,showPromptSetting:()=>Z(!0),showPromptHints:()=>{var e;if(F.length>0){B([]);return}null===(e=c.current)||void 0===e||e.focus(),d("/"),R("")}}),(0,E.jsxs)("label",{className:"".concat(ep()["chat-input-panel-inner"]," ").concat(0!=y.length?ep()["chat-input-panel-inner-attach"]:""),htmlFor:"chat-input",children:[(0,E.jsx)("textarea",{id:"chat-input",ref:c,className:ep()["chat-input"],placeholder:ed.ZP.Chat.Input(h),onInput:e=>$(e.currentTarget.value),value:m,onKeyDown:e=>{if("ArrowUp"===e.key&&m.length<=0&&!(e.metaKey||e.altKey||e.ctrlKey)){var t;d(null!==(t=localStorage.getItem(ex.Sb))&&void 0!==t?t:""),e.preventDefault();return}u(e)&&0===F.length&&(ee(m),e.preventDefault())},onFocus:eE,onClick:eE,onPaste:eN,rows:Q,autoFocus:!j,style:{fontSize:a.fontSize}}),0!=y.length&&(0,E.jsx)("div",{className:ep()["attach-images"],children:y.map((e,t)=>(0,E.jsx)("div",{className:ep()["attach-image"],style:{backgroundImage:'url("'.concat(e,'")')},children:(0,E.jsx)("div",{className:ep()["attach-image-template"],children:(0,E.jsx)(eG,{deleteImage:()=>{k(y.filter((e,n)=>n!==t))}})})},t))}),l?(0,E.jsx)(eh.h,{icon:(0,E.jsx)(es,{}),text:ed.ZP.Chat.InputActions.Stop,className:ep()["chat-input-send"],type:"primary",onClick:()=>et()}):(0,E.jsx)(eh.h,{icon:(0,E.jsx)(O,{}),text:ed.ZP.Chat.Send,className:ep()["chat-input-send"],type:"primary",onClick:()=>ee(m)})]})]}),i&&(0,E.jsx)(eZ,{onClose:()=>o(!1)}),P&&(0,E.jsx)(eB,{onClose:()=>Z(!1)})]},s.id)}function eJ(){let e=(0,el.aK)(),t=e.currentSessionIndex;return(0,E.jsx)(eU,{},t)}},3566:function(e,t,n){"use strict";n.d(t,{f:function(){return c},o:function(){return o}});var s=n(6147),a=n(2416),r=n(2908),l=n(5842),i=n(7537);let o={ready:!1,builtinEngine:new s.Z([],{keys:["title"]}),userEngine:new s.Z([],{keys:["title"]}),count:{builtin:0},allPrompts:[],builtinPrompts:[],init(e,t){this.ready||(this.allPrompts=t.concat(e),this.builtinPrompts=e.slice(),this.builtinEngine.setCollection(e),this.userEngine.setCollection(t),this.ready=!0)},remove(e){this.userEngine.remove(t=>t.id===e)},add(e){this.userEngine.add(e)},search(e){let t=this.userEngine.search(e),n=this.builtinEngine.search(e);return t.concat(n).map(e=>e.item)}},c=(0,i.D)({counter:0,prompts:{}},(e,t)=>({add(n){let s=t().prompts;return n.id=(0,l.x0)(),n.isUser=!0,n.createdAt=Date.now(),s[n.id]=n,e(()=>({prompts:s})),n.id},get(e){let n=t().prompts[e];return n||o.builtinPrompts.find(t=>t.id===e)},remove(n){let s=t().prompts;delete s[n],Object.entries(s).some(e=>{let[t,a]=e;return a.id===n&&(delete s[t],!0)}),o.remove(n),e(()=>({prompts:s,counter:t().counter+1}))},getUserPrompts(){var e;let n=Object.values(null!==(e=t().prompts)&&void 0!==e?e:{});return n.sort((e,t)=>t.id&&e.id?t.createdAt-e.createdAt:0),n},updatePrompt(n,s){var a;let r=null!==(a=t().prompts[n])&&void 0!==a?a:{title:"",content:"",id:n};o.remove(n),s(r);let l=t().prompts;l[n]=r,e(()=>({prompts:l})),o.add(r)},search(e){return 0===e.length?this.getUserPrompts().concat(o.builtinPrompts):o.search(e)}}),{name:r.KJ.Prompt,onRehydrateStorage(e){fetch("./prompts.json").then(e=>e.json()).then(e=>{var t;let n=[e.en,e.cn];"cn"===(0,a.VQ)()&&(n=n.reverse());let s=n.map(e=>e.map(e=>{let[t,n]=e;return{id:(0,l.x0)(),title:t,content:n,createdAt:Date.now()}})),r=null!==(t=c.getState().getUserPrompts())&&void 0!==t?t:[],i=s.reduce((e,t)=>e.concat(t),[]).filter(e=>!!e.title&&!!e.content);o.count.builtin=e.en.length+e.cn.length,o.init(i,r)})}})},6963:function(e){e.exports={"message-exporter-body":"exporter_message-exporter-body__ieezO","export-content":"exporter_export-content__bLZvx",steps:"exporter_steps__6n3hv","steps-progress":"exporter_steps-progress__BaZCB","steps-progress-inner":"exporter_steps-progress-inner__Bx3Y4","steps-inner":"exporter_steps-inner__EVqvK",step:"exporter_step__WhCEO","step-finished":"exporter_step-finished__eBg9d","step-current":"exporter_step-current__oh5Mc","step-index":"exporter_step-index__bWRYR","step-name":"exporter_step-name__aj81m","preview-actions":"exporter_preview-actions__EdSLJ","image-previewer":"exporter_image-previewer__uKfNQ","preview-body":"exporter_preview-body__qK5Zf","chat-info":"exporter_chat-info__N_j5m",icons:"exporter_icons__7WRoV",logo:"exporter_logo__zu13e","main-title":"exporter_main-title__jjxAd","sub-title":"exporter_sub-title__p1RCl","icon-space":"exporter_icon-space__u_tMK","chat-info-item":"exporter_chat-info-item__3D12j",message:"exporter_message__3aahS",avatar:"exporter_avatar__fGOtt",user_avatar:"exporter_user_avatar__fJzLv",body:"exporter_body__gcKIl","message-image":"exporter_message-image__ofOeC","message-images":"exporter_message-images__oJoIX","message-image-multi":"exporter_message-image-multi__jzQdX","message-assistant":"exporter_message-assistant__sDmHi","message-user":"exporter_message-user__2t254"}},5106:function(e){e.exports={"message-selector":"message-selector_message-selector__dOKbo","message-filter":"message-selector_message-filter__Q5XSd","search-bar":"message-selector_search-bar__4E5gq",actions:"message-selector_actions__MyZCT",messages:"message-selector_messages__GbOLr",message:"message-selector_message___TaV9","message-selected":"message-selector_message-selected__b3mDv",avatar:"message-selector_avatar__HCJ8t",body:"message-selector_body__rKEIZ",date:"message-selector_date__vc48w",content:"message-selector_content__Z9W8L",checkbox:"message-selector_checkbox__erPyd"}}}]);