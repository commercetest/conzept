"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[801],{3177:function(e,t,r){/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var i=r(6006),n=Symbol.for("react.element"),s=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,l={key:!0,ref:!0,__self:!0,__source:!0};function h(e,t,r){var i,s={},h=null,u=null;for(i in void 0!==r&&(h=""+r),void 0!==t.key&&(h=""+t.key),void 0!==t.ref&&(u=t.ref),t)o.call(t,i)&&!l.hasOwnProperty(i)&&(s[i]=t[i]);if(e&&e.defaultProps)for(i in t=e.defaultProps)void 0===s[i]&&(s[i]=t[i]);return{$$typeof:n,type:e,key:h,ref:u,props:s,_owner:a.current}}t.Fragment=s,t.jsx=h,t.jsxs=h},9268:function(e,t,r){e.exports=r(3177)},3907:function(e,t,r){let i,n;r.d(t,{P6:function(){return er},xW:function(){return Y}});var s,o=r(5856);/*! noble-secp256k1 - MIT License (c) 2019 Paul Miller (paulmillr.com) */let a=BigInt(0),l=BigInt(1),h=BigInt(2),u=BigInt(3),f=BigInt(8),c=Object.freeze({a:a,b:BigInt(7),P:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:l,Gx:BigInt("55066263022277343669578718895168534326250603453777594175500187360389116729240"),Gy:BigInt("32670510020758816978083085130507043184471273380659243275938904335757337482424"),beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee")}),d=(e,t)=>(e+t/h)/t,y={beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar(e){let{n:t}=c,r=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),i=-l*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),n=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=BigInt("0x100000000000000000000000000000000"),o=d(r*e,t),a=d(-i*e,t),h=U(e-o*r-a*n,t),u=U(-o*i-a*r,t),f=h>s,y=u>s;if(f&&(h=t-h),y&&(u=t-u),h>s||u>s)throw Error("splitScalarEndo: Endomorphism failed, k="+e);return{k1neg:f,k1:h,k2neg:y,k2:u}}};function g(e){let{a:t,b:r}=c,i=U(e*e),n=U(i*e);return U(n+t*e+r)}let p=c.a===a;class v extends Error{constructor(e){super(e)}}function w(e){if(!(e instanceof b))throw TypeError("JacobianPoint expected")}class b{constructor(e,t,r){this.x=e,this.y=t,this.z=r}static fromAffine(e){if(!(e instanceof x))throw TypeError("JacobianPoint#fromAffine: expected Point");return e.equals(x.ZERO)?b.ZERO:new b(e.x,e.y,l)}static toAffineBatch(e){let t=function(e,t=c.P){let r=Array(e.length),i=e.reduce((e,i,n)=>i===a?e:(r[n]=e,U(e*i,t)),l),n=z(i,t);return e.reduceRight((e,i,n)=>i===a?e:(r[n]=U(e*r[n],t),U(e*i,t)),n),r}(e.map(e=>e.z));return e.map((e,r)=>e.toAffine(t[r]))}static normalizeZ(e){return b.toAffineBatch(e).map(b.fromAffine)}equals(e){w(e);let{x:t,y:r,z:i}=this,{x:n,y:s,z:o}=e,a=U(i*i),l=U(o*o),h=U(t*l),u=U(n*a),f=U(U(r*o)*l),c=U(U(s*i)*a);return h===u&&f===c}negate(){return new b(this.x,U(-this.y),this.z)}double(){let{x:e,y:t,z:r}=this,i=U(e*e),n=U(t*t),s=U(n*n),o=e+n,a=U(h*(U(o*o)-i-s)),l=U(u*i),c=U(l*l),d=U(c-h*a),y=U(l*(a-d)-f*s),g=U(h*t*r);return new b(d,y,g)}add(e){w(e);let{x:t,y:r,z:i}=this,{x:n,y:s,z:o}=e;if(n===a||s===a)return this;if(t===a||r===a)return e;let l=U(i*i),u=U(o*o),f=U(t*u),c=U(n*l),d=U(U(r*o)*u),y=U(U(s*i)*l),g=U(c-f),p=U(y-d);if(g===a)return p===a?this.double():b.ZERO;let v=U(g*g),m=U(g*v),E=U(f*v),x=U(p*p-m-h*E),A=U(p*(E-x)-d*m),S=U(i*o*g);return new b(x,A,S)}subtract(e){return this.add(e.negate())}multiplyUnsafe(e){let t=b.ZERO;if("bigint"==typeof e&&e===a)return t;let r=D(e);if(r===l)return this;if(!p){let e=t,i=this;for(;r>a;)r&l&&(e=e.add(i)),i=i.double(),r>>=l;return e}let{k1neg:i,k1:n,k2neg:s,k2:o}=y.splitScalar(r),h=t,u=t,f=this;for(;n>a||o>a;)n&l&&(h=h.add(f)),o&l&&(u=u.add(f)),f=f.double(),n>>=l,o>>=l;return i&&(h=h.negate()),s&&(u=u.negate()),u=new b(U(u.x*y.beta),u.y,u.z),h.add(u)}precomputeWindow(e){let t=p?128/e+1:256/e+1,r=[],i=this,n=i;for(let s=0;s<t;s++){n=i,r.push(n);for(let t=1;t<2**(e-1);t++)n=n.add(i),r.push(n);i=n.double()}return r}wNAF(e,t){!t&&this.equals(b.BASE)&&(t=x.BASE);let r=t&&t._WINDOW_SIZE||1;if(256%r)throw Error("Point#wNAF: Invalid precomputation window, must be power of 2");let i=t&&E.get(t);!i&&(i=this.precomputeWindow(r),t&&1!==r&&(i=b.normalizeZ(i),E.set(t,i)));let n=b.ZERO,s=b.BASE,o=1+(p?128/r:256/r),a=2**(r-1),h=BigInt(2**r-1),u=2**r,f=BigInt(r);for(let t=0;t<o;t++){let r=t*a,o=Number(e&h);e>>=f,o>a&&(o-=u,e+=l);let c=r+Math.abs(o)-1,d=t%2!=0,y=o<0;0===o?s=s.add(m(d,i[r])):n=n.add(m(y,i[c]))}return{p:n,f:s}}multiply(e,t){let r,i,n=D(e);if(p){let{k1neg:e,k1:s,k2neg:o,k2:a}=y.splitScalar(n),{p:l,f:h}=this.wNAF(s,t),{p:u,f:f}=this.wNAF(a,t);l=m(e,l),u=m(o,u),u=new b(U(u.x*y.beta),u.y,u.z),r=l.add(u),i=h.add(f)}else{let{p:e,f:s}=this.wNAF(n,t);r=e,i=s}return b.normalizeZ([r,i])[0]}toAffine(e){let{x:t,y:r,z:i}=this,n=this.equals(b.ZERO);null==e&&(e=n?f:z(i));let s=e,o=U(s*s),a=U(o*s),h=U(t*o),u=U(r*a),c=U(i*s);if(n)return x.ZERO;if(c!==l)throw Error("invZ was invalid");return new x(h,u)}}function m(e,t){let r=t.negate();return e?r:t}b.BASE=new b(c.Gx,c.Gy,l),b.ZERO=new b(a,l,a);let E=new WeakMap;class x{constructor(e,t){this.x=e,this.y=t}_setWindowSize(e){this._WINDOW_SIZE=e,E.delete(this)}hasEvenY(){return this.y%h===a}static fromCompressedHex(e){let t=32===e.length,r=C(t?e:e.subarray(1));if(!_(r))throw Error("Point is not on curve");let i=g(r),n=function(e){let{P:t}=c,r=BigInt(6),i=BigInt(11),n=BigInt(22),s=BigInt(23),o=BigInt(44),a=BigInt(88),l=e*e*e%t,f=l*l*e%t,d=F(f,u)*f%t,y=F(d,u)*f%t,g=F(y,h)*l%t,p=F(g,i)*g%t,v=F(p,n)*p%t,w=F(v,o)*v%t,b=F(w,a)*w%t,m=F(b,o)*v%t,E=F(m,u)*f%t,x=F(E,s)*p%t,A=F(x,r)*l%t,S=F(A,h);if(S*S%t!==e)throw Error("Cannot find square root");return S}(i),s=(n&l)===l;if(t)s&&(n=U(-n));else{let t=(1&e[0])==1;t!==s&&(n=U(-n))}let o=new x(r,n);return o.assertValidity(),o}static fromUncompressedHex(e){let t=C(e.subarray(1,33)),r=C(e.subarray(33,65)),i=new x(t,r);return i.assertValidity(),i}static fromHex(e){let t=W(e),r=t.length,i=t[0];if(32===r||33===r&&(2===i||3===i))return this.fromCompressedHex(t);if(65===r&&4===i)return this.fromUncompressedHex(t);throw Error(`Point.fromHex: received invalid point. Expected 32-33 compressed bytes or 65 uncompressed bytes, not ${r}`)}static fromPrivateKey(e){return x.BASE.multiply(q(e))}static fromSignature(e,t,r){let{r:i,s:n}=function(e){if(e instanceof R)return e.assertValidity(),e;try{return R.fromDER(e)}catch(t){return R.fromCompact(e)}}(t);if(![0,1,2,3].includes(r))throw Error("Cannot recover: invalid recovery bit");let s=function(e,t=!1){let r=function(e){let t=8*e.length-256,r=C(e);return t>0?r>>BigInt(t):r}(e);if(t)return r;let{n:i}=c;return r>=i?r-i:r}(W(e)),{n:o}=c,a=2===r||3===r?i+o:i,l=z(a,o),h=U(-s*l,o),u=U(n*l,o),f=1&r?"03":"02",d=x.fromHex(f+P(a)),y=x.BASE.multiplyAndAddUnsafe(d,h,u);if(!y)throw Error("Cannot recover signature: point at infinify");return y.assertValidity(),y}toRawBytes(e=!1){return N(this.toHex(e))}toHex(e=!1){let t=P(this.x);if(!e)return`04${t}${P(this.y)}`;{let e=this.hasEvenY()?"02":"03";return`${e}${t}`}}toHexX(){return this.toHex(!0).slice(2)}toRawX(){return this.toRawBytes(!0).slice(1)}assertValidity(){let e="Point is not on elliptic curve",{x:t,y:r}=this;if(!_(t)||!_(r))throw Error(e);let i=U(r*r),n=g(t);if(U(i-n)!==a)throw Error(e)}equals(e){return this.x===e.x&&this.y===e.y}negate(){return new x(this.x,U(-this.y))}double(){return b.fromAffine(this).double().toAffine()}add(e){return b.fromAffine(this).add(b.fromAffine(e)).toAffine()}subtract(e){return this.add(e.negate())}multiply(e){return b.fromAffine(this).multiply(e,this).toAffine()}multiplyAndAddUnsafe(e,t,r){let i=b.fromAffine(this),n=t===a||t===l||this!==x.BASE?i.multiplyUnsafe(t):i.multiply(t),s=b.fromAffine(e).multiplyUnsafe(r),o=n.add(s);return o.equals(b.ZERO)?void 0:o.toAffine()}}function A(e){return Number.parseInt(e[0],16)>=8?"00"+e:e}function S(e){if(e.length<2||2!==e[0])throw Error(`Invalid signature integer tag: ${B(e)}`);let t=e[1],r=e.subarray(2,t+2);if(!t||r.length!==t)throw Error("Invalid signature integer: wrong length");if(0===r[0]&&r[1]<=127)throw Error("Invalid signature integer: trailing length");return{data:C(r),left:e.subarray(t+2)}}x.BASE=new x(c.Gx,c.Gy),x.ZERO=new x(a,a);class R{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromCompact(e){let t=e instanceof Uint8Array,r="Signature.fromCompact";if("string"!=typeof e&&!t)throw TypeError(`${r}: Expected string or Uint8Array`);let i=t?B(e):e;if(128!==i.length)throw Error(`${r}: Expected 64-byte hex`);return new R(H(i.slice(0,64)),H(i.slice(64,128)))}static fromDER(e){let t=e instanceof Uint8Array;if("string"!=typeof e&&!t)throw TypeError("Signature.fromDER: Expected string or Uint8Array");let{r,s:i}=function(e){if(e.length<2||48!=e[0])throw Error(`Invalid signature tag: ${B(e)}`);if(e[1]!==e.length-2)throw Error("Invalid signature: incorrect length");let{data:t,left:r}=S(e.subarray(2)),{data:i,left:n}=S(r);if(n.length)throw Error(`Invalid signature: left bytes after parsing: ${B(n)}`);return{r:t,s:i}}(t?e:N(e));return new R(r,i)}static fromHex(e){return this.fromDER(e)}assertValidity(){let{r:e,s:t}=this;if(!L(e))throw Error("Invalid Signature: r must be 0 < r < n");if(!L(t))throw Error("Invalid Signature: s must be 0 < s < n")}hasHighS(){let e=c.n>>l;return this.s>e}normalizeS(){return this.hasHighS()?new R(this.r,U(-this.s,c.n)):this}toDERRawBytes(){return N(this.toDERHex())}toDERHex(){let e=A(O(this.s)),t=A(O(this.r)),r=e.length/2,i=t.length/2,n=O(r),s=O(i),o=O(i+r+4);return`30${o}02${s}${t}02${n}${e}`}toRawBytes(){return this.toDERRawBytes()}toHex(){return this.toDERHex()}toCompactRawBytes(){return N(this.toCompactHex())}toCompactHex(){return P(this.r)+P(this.s)}}function k(...e){if(!e.every(e=>e instanceof Uint8Array))throw Error("Uint8Array list expected");if(1===e.length)return e[0];let t=e.reduce((e,t)=>e+t.length,0),r=new Uint8Array(t);for(let t=0,i=0;t<e.length;t++){let n=e[t];r.set(n,i),i+=n.length}return r}let I=Array.from({length:256},(e,t)=>t.toString(16).padStart(2,"0"));function B(e){if(!(e instanceof Uint8Array))throw Error("Expected Uint8Array");let t="";for(let r=0;r<e.length;r++)t+=I[e[r]];return t}let T=BigInt("0x10000000000000000000000000000000000000000000000000000000000000000");function P(e){if("bigint"!=typeof e)throw Error("Expected bigint");if(!(a<=e&&e<T))throw Error("Expected number 0 <= n < 2^256");return e.toString(16).padStart(64,"0")}function $(e){let t=N(P(e));if(32!==t.length)throw Error("Error: expected 32 bytes");return t}function O(e){let t=e.toString(16);return 1&t.length?`0${t}`:t}function H(e){if("string"!=typeof e)throw TypeError("hexToNumber: expected string, got "+typeof e);return BigInt(`0x${e}`)}function N(e){if("string"!=typeof e)throw TypeError("hexToBytes: expected string, got "+typeof e);if(e.length%2)throw Error("hexToBytes: received invalid unpadded hex"+e.length);let t=new Uint8Array(e.length/2);for(let r=0;r<t.length;r++){let i=2*r,n=e.slice(i,i+2),s=Number.parseInt(n,16);if(Number.isNaN(s)||s<0)throw Error("Invalid byte sequence");t[r]=s}return t}function C(e){return H(B(e))}function W(e){return e instanceof Uint8Array?Uint8Array.from(e):N(e)}function D(e){if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)return BigInt(e);if("bigint"==typeof e&&L(e))return e;throw TypeError("Expected valid private scalar: 0 < scalar < curve.n")}function U(e,t=c.P){let r=e%t;return r>=a?r:t+r}function F(e,t){let{P:r}=c,i=e;for(;t-- >a;)i*=i,i%=r;return i}function z(e,t=c.P){if(e===a||t<=a)throw Error(`invert: expected positive integers, got n=${e} mod=${t}`);let r=U(e,t),i=t,n=a,s=l,o=l,h=a;for(;r!==a;){let e=i/r,t=i%r,a=n-o*e,l=s-h*e;i=r,r=t,n=o,s=h,o=a,h=l}let u=i;if(u!==l)throw Error("invert: does not exist");return U(n,t)}function L(e){return a<e&&e<c.n}function _(e){return a<e&&e<c.P}function q(e){let t;if("bigint"==typeof e)t=e;else if("number"==typeof e&&Number.isSafeInteger(e)&&e>0)t=BigInt(e);else if("string"==typeof e){if(64!==e.length)throw Error("Expected 32 bytes of private key");t=H(e)}else if(e instanceof Uint8Array){if(32!==e.length)throw Error("Expected 32 bytes of private key");t=C(e)}else throw TypeError("Expected valid private key");if(!L(t))throw Error("Expected private key: 0 < key < n");return t}function V(e){return U(C(e),c.n)}class Z{constructor(e,t){this.r=e,this.s=t,this.assertValidity()}static fromHex(e){let t=W(e);if(64!==t.length)throw TypeError(`SchnorrSignature.fromHex: expected 64 bytes, not ${t.length}`);let r=C(t.subarray(0,32)),i=C(t.subarray(32,64));return new Z(r,i)}assertValidity(){let{r:e,s:t}=this;if(!_(e)||!L(t))throw Error("Invalid signature")}toHex(){return P(this.r)+P(this.s)}toRawBytes(){return N(this.toHex())}}class j{constructor(e,t,r=er.randomBytes()){if(null==e)throw TypeError(`sign: Expected valid message, not "${e}"`);this.m=W(e);let{x:i,scalar:n}=this.getScalar(q(t));if(this.px=i,this.d=n,this.rand=W(r),32!==this.rand.length)throw TypeError("sign: Expected 32 bytes of aux randomness")}getScalar(e){let t=x.fromPrivateKey(e),r=t.hasEvenY()?e:c.n-e;return{point:t,scalar:r,x:t.toRawX()}}initNonce(e,t){return $(e^C(t))}finalizeNonce(e){let t=U(C(e),c.n);if(t===a)throw Error("sign: Creation of signature failed. k is zero");let{point:r,x:i,scalar:n}=this.getScalar(t);return{R:r,rx:i,k:n}}finalizeSig(e,t,r,i){return new Z(e.x,U(t+r*i,c.n)).toRawBytes()}error(){throw Error("sign: Invalid signature produced")}async calc(){let{m:e,d:t,px:r,rand:i}=this,n=er.taggedHash,s=this.initNonce(t,await n(ee.aux,i)),{R:o,rx:a,k:l}=this.finalizeNonce(await n(ee.nonce,s,r,e)),h=V(await n(ee.challenge,a,r,e)),u=this.finalizeSig(o,l,h,t);return await G(u,e,r)||this.error(),u}calcSync(){let{m:e,d:t,px:r,rand:i}=this,n=er.taggedHashSync,s=this.initNonce(t,n(ee.aux,i)),{R:o,rx:a,k:l}=this.finalizeNonce(n(ee.nonce,s,r,e)),h=V(n(ee.challenge,a,r,e)),u=this.finalizeSig(o,l,h,t);return X(u,e,r)||this.error(),u}}async function K(e,t,r){return new j(e,t,r).calc()}function M(e,t,r){let i=e instanceof Z,n=i?e:Z.fromHex(e);return i&&n.assertValidity(),{...n,m:W(t),P:r instanceof x?(r.assertValidity(),r):x.fromHex(r)}}function J(e,t,r,i){let n=x.BASE.multiplyAndAddUnsafe(t,q(r),U(-i,c.n));return!!(n&&n.hasEvenY())&&n.x===e}async function G(e,t,r){try{let{r:i,s:n,m:s,P:o}=M(e,t,r),a=V(await er.taggedHash(ee.challenge,$(i),o.toRawX(),s));return J(i,o,n,a)}catch(e){return!1}}function X(e,t,r){try{let{r:i,s:n,m:s,P:o}=M(e,t,r),a=V(er.taggedHashSync(ee.challenge,$(i),o.toRawX(),s));return J(i,o,n,a)}catch(e){if(e instanceof v)throw e;return!1}}let Y={Signature:Z,getPublicKey:function(e){return x.fromPrivateKey(e).toRawX()},sign:K,verify:G,signSync:function(e,t,r){return new j(e,t,r).calcSync()},verifySync:X};x.BASE._setWindowSize(8);let Q={node:s||(s=r.t(o,2)),web:"object"==typeof self&&"crypto"in self?self.crypto:void 0},ee={challenge:"BIP0340/challenge",aux:"BIP0340/aux",nonce:"BIP0340/nonce"},et={},er={bytesToHex:B,hexToBytes:N,concatBytes:k,mod:U,invert:z,isValidPrivateKey(e){try{return q(e),!0}catch(e){return!1}},_bigintTo32Bytes:$,_normalizePrivateKey:q,hashToPrivateKey:e=>{if((e=W(e)).length<40||e.length>1024)throw Error("Expected valid bytes of private key as per FIPS 186");let t=U(C(e),c.n-l)+l;return $(t)},randomBytes:(e=32)=>{if(Q.web)return Q.web.getRandomValues(new Uint8Array(e));if(Q.node){let{randomBytes:t}=Q.node;return Uint8Array.from(t(e))}throw Error("The environment doesn't have randomBytes function")},randomPrivateKey:()=>er.hashToPrivateKey(er.randomBytes(40)),precompute(e=8,t=x.BASE){let r=t===x.BASE?t:new x(t.x,t.y);return r._setWindowSize(e),r.multiply(u),r},sha256:async(...e)=>{if(Q.web){let t=await Q.web.subtle.digest("SHA-256",k(...e));return new Uint8Array(t)}if(Q.node){let{createHash:t}=Q.node,r=t("sha256");return e.forEach(e=>r.update(e)),Uint8Array.from(r.digest())}throw Error("The environment doesn't have sha256 function")},hmacSha256:async(e,...t)=>{if(Q.web){let r=await Q.web.subtle.importKey("raw",e,{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]),i=k(...t),n=await Q.web.subtle.sign("HMAC",r,i);return new Uint8Array(n)}if(Q.node){let{createHmac:r}=Q.node,i=r("sha256",e);return t.forEach(e=>i.update(e)),Uint8Array.from(i.digest())}throw Error("The environment doesn't have hmac-sha256 function")},sha256Sync:void 0,hmacSha256Sync:void 0,taggedHash:async(e,...t)=>{let r=et[e];if(void 0===r){let t=await er.sha256(Uint8Array.from(e,e=>e.charCodeAt(0)));r=k(t,t),et[e]=r}return er.sha256(r,...t)},taggedHashSync:(e,...t)=>{if("function"!=typeof i)throw new v("sha256Sync is undefined, you need to set it");let r=et[e];if(void 0===r){let t=i(Uint8Array.from(e,e=>e.charCodeAt(0)));r=k(t,t),et[e]=r}return i(r,...t)},_JacobianPoint:b};Object.defineProperties(er,{sha256Sync:{configurable:!1,get:()=>i,set(e){i||(i=e)}},hmacSha256Sync:{configurable:!1,get:()=>n,set(e){n||(n=e)}}})},5999:function(e,t,r){/*! scure-base - MIT License (c) 2022 Paul Miller (paulmillr.com) */function i(e){if(!Number.isSafeInteger(e))throw Error(`Wrong integer: ${e}`)}function n(...e){let t=(e,t)=>r=>e(t(r)),r=Array.from(e).reverse().reduce((e,r)=>e?t(e,r.encode):r.encode,void 0),i=e.reduce((e,r)=>e?t(e,r.decode):r.decode,void 0);return{encode:r,decode:i}}function s(e){return{encode:t=>{if(!Array.isArray(t)||t.length&&"number"!=typeof t[0])throw Error("alphabet.encode input should be an array of numbers");return t.map(t=>{if(i(t),t<0||t>=e.length)throw Error(`Digit index outside alphabet: ${t} (alphabet: ${e.length})`);return e[t]})},decode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw Error("alphabet.decode input should be array of strings");return t.map(t=>{if("string"!=typeof t)throw Error(`alphabet.decode: not string element=${t}`);let r=e.indexOf(t);if(-1===r)throw Error(`Unknown letter: "${t}". Allowed: ${e}`);return r})}}}function o(e=""){if("string"!=typeof e)throw Error("join separator should be string");return{encode:t=>{if(!Array.isArray(t)||t.length&&"string"!=typeof t[0])throw Error("join.encode input should be array of strings");for(let e of t)if("string"!=typeof e)throw Error(`join.encode: non-string input=${e}`);return t.join(e)},decode:t=>{if("string"!=typeof t)throw Error("join.decode input should be string");return t.split(e)}}}function a(e,t="="){if(i(e),"string"!=typeof t)throw Error("padding chr should be string");return{encode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw Error("padding.encode input should be array of strings");for(let e of r)if("string"!=typeof e)throw Error(`padding.encode: non-string input=${e}`);for(;r.length*e%8;)r.push(t);return r},decode(r){if(!Array.isArray(r)||r.length&&"string"!=typeof r[0])throw Error("padding.encode input should be array of strings");for(let e of r)if("string"!=typeof e)throw Error(`padding.decode: non-string input=${e}`);let i=r.length;if(i*e%8)throw Error("Invalid padding: string should have whole number of bytes");for(;i>0&&r[i-1]===t;i--)if(!((i-1)*e%8))throw Error("Invalid padding: string has too much padding");return r.slice(0,i)}}}function l(e){if("function"!=typeof e)throw Error("normalize fn should be function");return{encode:e=>e,decode:t=>e(t)}}function h(e,t,r){if(t<2)throw Error(`convertRadix: wrong from=${t}, base cannot be less than 2`);if(r<2)throw Error(`convertRadix: wrong to=${r}, base cannot be less than 2`);if(!Array.isArray(e))throw Error("convertRadix: data should be array");if(!e.length)return[];let n=0,s=[],o=Array.from(e);for(o.forEach(e=>{if(i(e),e<0||e>=t)throw Error(`Wrong integer: ${e}`)});;){let e=0,i=!0;for(let s=n;s<o.length;s++){let a=o[s],l=t*e+a;if(!Number.isSafeInteger(l)||t*e/t!==e||l-a!=t*e||(e=l%r,o[s]=Math.floor(l/r),!Number.isSafeInteger(o[s])||o[s]*r+e!==l))throw Error("convertRadix: carry overflow");i&&(o[s]?i=!1:n=s)}if(s.push(e),i)break}for(let t=0;t<e.length-1&&0===e[t];t++)s.push(0);return s.reverse()}r.d(t,{$Q:function(){return S},Ps:function(){return R},NL:function(){return A}});let u=(e,t)=>t?u(t,e%t):e,f=(e,t)=>e+(t-u(e,t));function c(e,t,r,n){if(!Array.isArray(e))throw Error("convertRadix2: data should be array");if(t<=0||t>32)throw Error(`convertRadix2: wrong from=${t}`);if(r<=0||r>32)throw Error(`convertRadix2: wrong to=${r}`);if(f(t,r)>32)throw Error(`convertRadix2: carry overflow from=${t} to=${r} carryBits=${f(t,r)}`);let s=0,o=0,a=2**r-1,l=[];for(let n of e){if(i(n),n>=2**t)throw Error(`convertRadix2: invalid data word=${n} from=${t}`);if(s=s<<t|n,o+t>32)throw Error(`convertRadix2: carry overflow pos=${o} from=${t}`);for(o+=t;o>=r;o-=r)l.push((s>>o-r&a)>>>0);s&=2**o-1}if(s=s<<r-o&a,!n&&o>=t)throw Error("Excess padding");if(!n&&s)throw Error(`Non-zero padding: ${s}`);return n&&o>0&&l.push(s>>>0),l}function d(e,t=!1){if(i(e),e<=0||e>32)throw Error("radix2: bits should be in (0..32]");if(f(8,e)>32||f(e,8)>32)throw Error("radix2: carry overflow");return{encode:r=>{if(!(r instanceof Uint8Array))throw Error("radix2.encode input should be Uint8Array");return c(Array.from(r),8,e,!t)},decode:r=>{if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw Error("radix2.decode input should be array of strings");return Uint8Array.from(c(r,e,8,t))}}}function y(e){if("function"!=typeof e)throw Error("unsafeWrapper fn should be function");return function(...t){try{return e.apply(null,t)}catch(e){}}}n(d(4),s("0123456789ABCDEF"),o("")),n(d(5),s("ABCDEFGHIJKLMNOPQRSTUVWXYZ234567"),a(5),o("")),n(d(5),s("0123456789ABCDEFGHIJKLMNOPQRSTUV"),a(5),o("")),n(d(5),s("0123456789ABCDEFGHJKMNPQRSTVWXYZ"),o(""),l(e=>e.toUpperCase().replace(/O/g,"0").replace(/[IL]/g,"1"))),n(d(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),a(6),o("")),n(d(6),s("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"),a(6),o(""));let g=e=>n((i(58),{encode:e=>{if(!(e instanceof Uint8Array))throw Error("radix.encode input should be Uint8Array");return h(Array.from(e),256,58)},decode:e=>{if(!Array.isArray(e)||e.length&&"number"!=typeof e[0])throw Error("radix.decode input should be array of strings");return Uint8Array.from(h(e,58,256))}}),s(e),o(""));g("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"),g("123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"),g("rpshnaf39wBUDNEGHJKLM4PQRST7VWXYZ2bcdeCg65jkm8oFqi1tuvAxyz");let p=n(s("qpzry9x8gf2tvdw0s3jn54khce6mua7l"),o("")),v=[996825010,642813549,513874426,1027748829,705979059];function w(e){let t=e>>25,r=(33554431&e)<<5;for(let e=0;e<v.length;e++)(t>>e&1)==1&&(r^=v[e]);return r}function b(e,t,r=1){let i=e.length,n=1;for(let t=0;t<i;t++){let r=e.charCodeAt(t);if(r<33||r>126)throw Error(`Invalid prefix (${e})`);n=w(n)^r>>5}n=w(n);for(let t=0;t<i;t++)n=w(n)^31&e.charCodeAt(t);for(let e of t)n=w(n)^e;for(let e=0;e<6;e++)n=w(n);return n^=r,p.encode(c([n%1073741824],30,5,!1))}function m(e){let t="bech32"===e?1:734539939,r=d(5),i=r.decode,n=r.encode,s=y(i);function o(e,r=90){if("string"!=typeof e)throw Error(`bech32.decode input should be string, not ${typeof e}`);if(e.length<8||!1!==r&&e.length>r)throw TypeError(`Wrong string length: ${e.length} (${e}). Expected (8..${r})`);let i=e.toLowerCase();if(e!==i&&e!==e.toUpperCase())throw Error("String must be lowercase or uppercase");e=i;let n=e.lastIndexOf("1");if(0===n||-1===n)throw Error('Letter "1" must be present between prefix and data only');let s=e.slice(0,n),o=e.slice(n+1);if(o.length<6)throw Error("Data must be at least 6 characters long");let a=p.decode(o).slice(0,-6),l=b(s,a,t);if(!o.endsWith(l))throw Error(`Invalid checksum in ${e}: expected "${l}"`);return{prefix:s,words:a}}let a=y(o);return{encode:function(e,r,i=90){if("string"!=typeof e)throw Error(`bech32.encode prefix should be string, not ${typeof e}`);if(!Array.isArray(r)||r.length&&"number"!=typeof r[0])throw Error(`bech32.encode words should be array of numbers, not ${typeof r}`);let n=e.length+7+r.length;if(!1!==i&&n>i)throw TypeError(`Length ${n} exceeds limit ${i}`);return e=e.toLowerCase(),`${e}1${p.encode(r)}${b(e,r,t)}`},decode:o,decodeToBytes:function(e){let{prefix:t,words:r}=o(e,!1);return{prefix:t,words:r,bytes:i(r)}},decodeUnsafe:a,fromWords:i,fromWordsUnsafe:s,toWords:n}}let E=m("bech32");m("bech32m"),n(d(4),s("0123456789abcdef"),o(""),l(e=>{if("string"!=typeof e||e.length%2)throw TypeError(`hex.decode: expected string, got ${typeof e} with length ${e.length}`);return e.toLowerCase()}));var x=r(3907);let A=e=>{let t=(()=>{try{return new URL(e)}catch(e){return}})();if(!t||"ws:"!==t.protocol&&"wss:"!==t.protocol)return;let r=t.origin;"/"!==t.pathname&&(r+=t.pathname),t.searchParams.sort();let i=t.searchParams.toString();return i.length>0&&(r+="?"+i),r},S=e=>{try{let{prefix:t,bytes:r}=E.decodeToBytes(e);if("npub"!==t&&"nsec"!==t&&"note"!==t)return;return{prefix:t,hexID:x.P6.bytesToHex(r)}}catch(e){return}},R=(e,t)=>{try{return E.encode(e,E.toWords(x.P6.hexToBytes(t)))}catch(e){return}}},2900:function(e,t,r){r.d(t,{wU:function(){return $},vh:function(){return k},ZD:function(){return m},up:function(){return I}});var i=r(3907),n=function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((i=i.apply(e,t||[])).next())})};let s=/^[0-9abcdef]{64}$/,o=/^[0-9abcdef]{128}$/,a=new TextEncoder,l=e=>{if("object"!=typeof e||null==e||Array.isArray(e))return"event is NOT object";let{id:t,pubkey:r,created_at:i,kind:n,tags:a,content:l,sig:u}=e;return"string"==typeof t&&s.test(t)?"string"==typeof r&&s.test(r)?"number"==typeof i&&Number.isInteger(i)?"number"==typeof n&&Number.isInteger(n)?h(a)?"string"!=typeof l?"content property is invalid":"string"==typeof u&&o.test(u)?{id:t,pubkey:r,created_at:i,kind:n,tags:a,content:l,sig:u}:"sig property is invalid":"tags property is invalid":"kind property is invalid":"created_at property is invalid":"pubkey property is invalid":"id property is invalid"},h=e=>{if(!Array.isArray(e))return!1;for(let t of e){if(!Array.isArray(t)||t.length<2)return!1;for(let e of t)if("string"!=typeof e)return!1;if(("e"===t[0]||"p"===t[0])&&!s.test(t[1]))return!1}return!0},u=e=>n(void 0,void 0,void 0,function*(){let t=a.encode(JSON.stringify([0,e.pubkey,e.created_at,e.kind,e.tags,e.content]));return i.P6.bytesToHex((yield i.P6.sha256(new Uint8Array(t))))}),f=e=>n(void 0,void 0,void 0,function*(){let t=l(e);return"string"==typeof t?`failed to verify event: ${t}`:t.id!==(yield u(t))?"failed to verify event: id property is invalid":(yield i.xW.verify(t.sig,t.id,t.pubkey))?t:"failed to verify event: sig property is invalid"}),c={debug:10,info:20,warn:30,error:40,supress:50},d=e=>void 0===e?new y(console,c.supress):"number"==typeof e?new y(console,e):e;class y{constructor(e,t){this.logger=e,this.level=t}debug(e,...t){this.level<=c.debug&&this.logger.debug(e,...t)}info(e,...t){this.level<=c.info&&this.logger.info(e,...t)}warn(e,...t){this.level<=c.warn&&this.logger.warn(e,...t)}error(e,...t){this.level<=c.error&&this.logger.error(e,...t)}}class g{constructor(){this.listeners=[]}listen(e){this.listeners.push(e)}stop(e){this.listeners=this.listeners.filter(t=>t!==e)}emit(e){for(let t of this.listeners)t(e)}reset(){this.listeners=[]}}var p=r(5999),v=function(e,t,r,i){return new(r||(r=Promise))(function(n,s){function o(e){try{l(i.next(e))}catch(e){s(e)}}function a(e){try{l(i.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?n(e.value):((t=e.value)instanceof r?t:new r(function(e){e(t)})).then(o,a)}l((i=i.apply(e,t||[])).next())})};let w=e=>v(void 0,void 0,void 0,function*(){let t;try{t=JSON.parse(e.data)}catch(e){return"invalid json"}if(!Array.isArray(t))return"NOT array";if(0===t.length)return"empty array";switch(t[0]){case"EVENT":if(3!==t.length||"string"!=typeof t[1])return"invalid EVENT";let r=yield f(t[2]);if("string"==typeof r)return`invalid EVENT(${r})`;return{type:"EVENT",subscriptionID:t[1],event:r};case"NOTICE":if(2!==t.length||"string"!=typeof t[1])return"invalid NOTICE";return{type:"NOTICE",message:t[1]};case"EOSE":if(2!==t.length||"string"!=typeof t[1])return"invalid EOSE";return{type:"EOSE",subscriptionID:t[1]};case"OK":if(4!==t.length||"string"!=typeof t[1]||"boolean"!=typeof t[2]||"string"!=typeof t[3])return"invalid OK";return{type:"OK",eventID:t[1],accepted:t[2],message:t[3]};default:return`unsupported message(${t[0]})`}}),b=(e,t)=>({type:"OK",eventID:e,accepted:!1,message:`error: client ${t}`});class m{constructor(e,t={}){let r=(0,p.NL)(e);if(!r)throw Error(`invalid WebSocket URL: ${e}`);this.url=r,this.read="boolean"!=typeof t.read||t.read,this.write="boolean"!=typeof t.write||t.write,this.log=d(t.logger),this.connectTimeout=t.connectTimeout||2e3,this.watchDogInterval=t.watchDogInterval||6e4,this.keepAliveTimeout=t.keepAliveTimeout||6e4,this.ws=null,this.watchDog=null,this.keepAlivedAt=null,this.subs={},this.cmds={},this.onHealthy=new g,this.onEvent=new g,this.onEose=new g,this.onResult=new g,this.handleWSOpen=()=>{this.log.debug(`[${this.url}] open`),this.keepAlived(),this.onHealthy.emit({relay:this})},this.handleWSClose=()=>this.reset("ws close"),this.handleWSMessage=e=>v(this,void 0,void 0,function*(){this.keepAlived();let t=yield w(e);if("string"==typeof t){this.log.warn(`[${this.url}] received ${t}`,e.data);return}switch(t.type){case"EVENT":this.onEvent.emit({relay:this,received:t});break;case"EOSE":this.emitEose(t.subscriptionID);break;case"OK":this.emitResult(t);break;case"NOTICE":this.log.info(`[${this.url}] received ${t.type}, but it is NOT supported yet`,t)}})}get isReadable(){return this.read}get isWritable(){return this.write}get isHealthy(){return!!(this.ws&&1===this.ws.readyState)}get mayBeDead(){return!this.keepAlivedAt||new Date().getTime()-this.keepAlivedAt>this.keepAliveTimeout}connect(){if(this.ws)return;this.startWatchDog(),this.reset("before connect"),this.ws=new WebSocket(this.url);let e=setTimeout(()=>{this.ws&&0===this.ws.readyState&&(this.log.warn(`[${this.url}] connection timed out`),this.reset("timeout"))},this.connectTimeout);this.ws.addEventListener("open",this.handleWSOpen),this.ws.addEventListener("open",()=>clearTimeout(e)),this.ws.addEventListener("message",this.handleWSMessage),this.ws.addEventListener("close",this.handleWSClose),this.ws.addEventListener("close",()=>clearTimeout(e)),this.ws.addEventListener("error",t=>{this.log.error(`[${this.url}] WebScoket error`),clearTimeout(e),t.target.close()})}updatePermission(e){if("boolean"==typeof e.read&&this.read!==e.read&&(this.read=e.read,!this.read))for(let e in this.subs)this.close(e);"boolean"==typeof e.write&&this.write!==e.write&&(this.write=e.write)}publish(e,t=5e3){var r;if(!this.isWritable)throw Error(`relay(${this.url}) is NOT writable`);this.cmds[e.id]||(this.log.debug(`[${this.url}] send event`,e),this.isHealthy&&(null===(r=this.ws)||void 0===r||r.send(JSON.stringify(["EVENT",e]))),this.cmds[e.id]=setTimeout(()=>{this.emitResult(b(e.id,"timeout"))},this.isHealthy?t:0))}request(e,t,r={}){var i;if(!this.isReadable)throw Error(`relay(${this.url}) is NOT readable`);if(!(e in this.subs)){if(!this.isHealthy)throw Error(`relay(${this.url}) is NOT healthy`);this.log.debug(`[${this.url}] send request: ${e}`,t),null===(i=this.ws)||void 0===i||i.send(JSON.stringify(["REQ",e,...t])),this.subs[e]=setTimeout(()=>this.emitEose(e),r.eoseTimeout||5e3)}}close(e){e in this.subs&&null!==this.ws&&(this.emitEose(e),delete this.subs[e],this.log.debug(`[${this.url}] close subscription: ${e}`),this.ws.send(JSON.stringify(["CLOSE",e])))}terminate(){this.watchDog&&clearInterval(this.watchDog),this.reset("close")}startWatchDog(){this.watchDogInterval<=0||(this.watchDog&&clearInterval(this.watchDog),this.watchDog=setInterval(()=>{this.ws&&this.mayBeDead&&this.reset("watchdog"),null===this.ws&&(this.log.debug(`[${this.url}] reconnect by watchdog`),this.connect())},this.watchDogInterval))}reset(e){for(let t in this.log.debug(`[${this.url}] reset by ${e}`),this.ws&&(this.ws.removeEventListener("open",this.handleWSOpen),this.ws.removeEventListener("message",this.handleWSMessage),this.ws.removeEventListener("close",this.handleWSClose),this.ws.close(),this.ws=null),this.subs)this.emitEose(t);for(let e in this.cmds)this.emitResult(b(e,"reset"));this.subs={},this.cmds={},this.keepAlivedAt=null}keepAlived(){this.keepAlivedAt=new Date().getTime()}emitEose(e){let t=this.subs[e];t&&(clearTimeout(t),this.subs[e]=null,this.onEose.emit({relay:this,received:{type:"EOSE",subscriptionID:e}}))}emitResult(e){let t=this.cmds[e.eventID];t&&(clearTimeout(t),delete this.cmds[e.eventID],this.onResult.emit({relay:this,received:e}))}}class E{install(e){}uninstall(){}capturePublishedEvent(e){}captureRequestedFilter(e){}captureReceivedEvent(e){}}class x{constructor(e){for(let t in e.ids&&(this.ids=new Set(e.ids)),e.authors&&(this.authors=new Set(e.authors)),e.kinds&&(this.kinds=new Set(e.kinds)),this.tags={},e)if(t.startsWith("#")){let r=t.slice(1);for(let t of(this.tags[r]||(this.tags[r]=new Set),e[`#${r}`]))this.tags[r].add(t)}this.since=e.since,this.until=e.until}test(e){if(this.ids&&!this.ids.has(e.id)||this.authors&&!this.authors.has(e.pubkey)||this.kinds&&!this.kinds.has(e.kind))return!1;let t=!0;for(let r in this.tags)if(!e.tags.find(e=>e[0]===r&&this.tags[r].has(e[1]))){t=!1;break}return!!t&&(!this.since||!(this.since>e.created_at))&&(!this.until||!(this.until<e.created_at))}}let A=e=>e.length>0;class S{constructor(e,t,r){this.id=e,this.sentFilterOnce=new Set(t.map(e=>e.url)),this.eoseWaitList=new Set(t.map(e=>e.url)),this.expectedEosesCount=this.eoseWaitList.size,this.filters=r.filters,this.eventMatchers=r.filters.map(e=>new x(e)),this.bufferOpts=r.enableBuffer||{flushInterval:0},this.buffered=[],this.eventHandler=r.onEvent,this.eoseHandler=r.onEose,this.partialEoseHandler=r.onPartialEose,this.recoveredHandler=r.onRecovered,0===this.eoseWaitList.size&&setTimeout(()=>{var e;return null===(e=this.eoseHandler)||void 0===e?void 0:e.call(this,this.id)},0)}get isAfterEose(){return 0===this.eoseWaitList.size}consumeEvent(e){for(let t of this.eventMatchers)if(t.test(e.received.event)){this.handleEvent(e);break}}consumeEose(e){var t,r;this.eoseWaitList.has(e)&&(this.eoseWaitList.delete(e),null===(t=this.partialEoseHandler)||void 0===t||t.call(this,this.id,e,this.expectedEosesCount,this.eoseWaitList.size),this.isAfterEose&&(this.flushBuffered(),null===(r=this.eoseHandler)||void 0===r||r.call(this,this.id)))}recoveryFilters(e){let t=!this.sentFilterOnce.has(e.url);return(this.sentFilterOnce.add(e.url),this.recoveredHandler)?this.recoveredHandler(e,t):t?this.filters:this.filters.map(e=>this.buildRecoveryFilter(e)).filter(e=>null!==e)}unSubscribe(){this.flushBuffered()}buildRecoveryFilter(e){let t=Math.floor(new Date().getTime()/1e3),r=Object.assign({},e);return r.until&&r.until<t?null:((!r.since||r.since<t)&&(r.since=t),r)}handleEvent(e){if(0===this.bufferOpts.flushInterval){this.eventHandler([e]);return}if(this.buffered.push(e),"number"==typeof this.bufferOpts.maxEventCount&&this.buffered.length>=this.bufferOpts.maxEventCount){this.flushBuffered();return}this.bufferFlusher||(this.bufferFlusher=setTimeout(()=>this.flushBuffered(),this.bufferOpts.flushInterval))}flushBuffered(){this.bufferFlusher&&(clearTimeout(this.bufferFlusher),this.bufferFlusher=void 0),A(this.buffered)&&(this.eventHandler(this.buffered),this.buffered=[])}}class R{constructor(e,t){this.waitList=new Set(e.map(e=>e.url)),this.results=[],this.onResult=t.onResult,this.onComplete=t.onComplete}get hasCompleted(){return 0===this.waitList.size}consumeResult(e){var t;this.waitList.has(e.relay.url)&&(this.waitList.delete(e.relay.url),this.results.push(e),null===(t=this.onResult)||void 0===t||t.call(this,e),this.hasCompleted&&this.onComplete&&this.onComplete(this.results))}}class k{constructor(){this.relays={},this.subs={},this.subIDSeq=1,this.cmds={},this.healthyWatchers=new Set,this.plugins={},this.handleRelayEvent=e=>{var t;for(let t in this.plugins)this.plugins[t].captureReceivedEvent(e);null===(t=this.subs[e.received.subscriptionID])||void 0===t||t.consumeEvent(e)},this.handleRelayEose=e=>{var t;null===(t=this.subs[e.received.subscriptionID])||void 0===t||t.consumeEose(e.relay.url)},this.handleRelayResult=e=>{let t=this.cmds[e.received.eventID];t&&(t.consumeResult(e),t.hasCompleted&&delete this.cmds[e.received.eventID])},this.handleRelayHealthy=e=>{for(let e of this.healthyWatchers)e();if(e.relay.isReadable)for(let t in this.subs){let r=this.subs[t].recoveryFilters(e.relay);r.length>0&&e.relay.request(t,r)}}}get allRelays(){return Object.values(this.relays)}get healthyRelays(){return this.allRelays.filter(e=>e.isHealthy)}installPlugin(e){this.plugins[e.id()]=e,e.install(this)}uninstallPlugin(e){this.plugins[e]&&(this.plugins[e].uninstall(),delete this.plugins[e])}addRelay(e){this.relays[e.url]||(e.onHealthy.listen(this.handleRelayHealthy),e.onEvent.listen(this.handleRelayEvent),e.onEose.listen(this.handleRelayEose),e.onResult.listen(this.handleRelayResult),e.connect(),this.relays[e.url]=e)}removeRelay(e){let t=this.relays[e];t&&(delete this.relays[e],t.terminate(),t.onHealthy.stop(this.handleRelayHealthy),t.onEvent.stop(this.handleRelayEvent),t.onEose.stop(this.handleRelayEose),t.onResult.stop(this.handleRelayResult))}waitRelayBecomesHealthy(e,t){return this.healthyRelays.length>=e?Promise.resolve(!0):new Promise(r=>{let i,n;i=setTimeout(()=>{this.healthyWatchers.delete(n),r(!1)},t),n=()=>{this.healthyRelays.length<e||(this.healthyWatchers.delete(n),clearTimeout(i),r(!0))},this.healthyWatchers.add(n)})}publish(e,t={}){let r=this.allRelays.filter(e=>e.isWritable&&(!t.relays||t.relays.find(t=>t===e.url)));if(0===r.length)throw Error("No relays for publishing");f(e).then(i=>{if("string"==typeof i)throw Error(`failed to publish event: ${i}`);for(let i of(this.cmds[e.id]=new R(r,t),r))i.publish(e,t.timeout||5e3);for(let t in this.plugins)this.plugins[t].capturePublishedEvent(e)}).catch(e=>{throw e})}subscribe(e){let t=e.id||`__sub:${this.subIDSeq++}`;if(this.subs[t])throw Error(`Subscription ID("${t}") has been used`);let r=this.healthyRelays.filter(e=>e.isReadable);for(let i of(this.subs[t]=new S(t,r,e),e.filters))for(let e in this.plugins)this.plugins[e].captureRequestedFilter(i);for(let i of r)i.request(t,e.filters,{eoseTimeout:e.eoseTimeout});return t}unSubscribe(e){for(let t of this.allRelays)t.close(e);this.subs[e]&&(this.subs[e].unSubscribe(),delete this.subs[e])}}let I=e=>{let t={},{name:r,display_name:i,about:n,picture:s,nip05:o}=e;return"string"==typeof r&&r.length>0&&(t.name=r),"string"==typeof i&&i.length>0&&(t.displayName=i),"string"==typeof n&&n.length>0&&(t.about=n),"string"==typeof s&&s.length>0&&(t.picture=s),"string"==typeof o&&o.length>0&&(t.nip05=o),t};class B{constructor(e,t){this.cache=new Map,this.capacity=e,this.autoEvict=t}get size(){return this.cache.size}get(e){let t=this.cache.get(e);if(void 0!==t)return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.delete(e),this.autoEvict&&this.cache.size>=this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}has(e){return this.cache.has(e)}evict(){let e=this.cache.size-this.capacity;if(e<1)return;let t=[],r=this.cache.keys();for(;e-- >0;)t.push(r.next().value);for(let e of t)this.cache.delete(e)}clear(){this.cache.clear()}}let T=(e,t)=>{let r;let i=e.received.event;if(0!==i.kind)return;try{r=JSON.parse(i.content)}catch(e){return}if(null===r||"object"!=typeof r||Array.isArray(r))return;let n=t(r);if(n)return{properties:n,createdAt:i.created_at,relayURL:e.relay.url}},P="__profile";class $ extends E{constructor(e){if(super(),this.parser=e.parser,!e.collectPubkeyFromEvent&&!e.collectPubkeyFromFilter)throw Error("AutoProfileSubscriber's options is NOT set collector function");this.cache=new B(e.cacheCapacity||1e3,"boolean"==typeof e.autoEvict&&e.autoEvict),this.tickInterval=e.tickInterval||1e3,this.timeout=e.timeout||5e3,this.pubkeyBacklog=new Set,this.waitingPromises={},this.collectPubkeyFromFilter=e.collectPubkeyFromFilter,this.collectPubkeyFromEvent=e.collectPubkeyFromEvent,this.earlyCallbackPredicate=e.earlyCallbackPredicate,this.ticker=()=>{var e,t,r,i;let n={kinds:[0],authors:[]},s={};for(let r of this.pubkeyBacklog){if(this.cache.has(r)){this.resolveWaitingPromises(r,null===(e=this.cache.get(r))||void 0===e?void 0:e.foundProfile);continue}s[r]={foundProfile:void 0},null===(t=n.authors)||void 0===t||t.push(r)}if(this.pubkeyBacklog.clear(),(null===(r=n.authors)||void 0===r?void 0:r.length)===0){this.finishTicker();return}let o=!1,a=()=>{var e;if(!o){for(let t in o=!0,null===(e=this.mux)||void 0===e||e.unSubscribe(P),s)this.cache.put(t,s[t]),this.resolveWaitingPromises(t,s[t].foundProfile);this.finishTicker()}};null===(i=this.mux)||void 0===i||i.subscribe({id:P,filters:[n],onEvent:e=>{for(let t of e){let e=t.received.event.pubkey,r=T(t,this.parser);if(!r)return;let i=s[e].foundProfile;(!i||i.createdAt<r.createdAt)&&(s[e].foundProfile=r)}},onPartialEose:(e,t,r,i)=>{var n;!o&&(null===(n=this.earlyCallbackPredicate)||void 0===n?void 0:n.call(this,t,r,i))&&a()},onEose:a,eoseTimeout:this.timeout})}}id(){return"auto_profile_subscriber"}install(e){this.mux=e}uninstall(){var e;for(let t in this.activeTicker&&(clearTimeout(this.activeTicker),this.activeTicker=void 0),null===(e=this.mux)||void 0===e||e.unSubscribe(P),this.mux=void 0,this.cache.clear(),this.pubkeyBacklog.clear(),this.waitingPromises)for(let e of this.waitingPromises[t])e(void 0);this.waitingPromises={}}capturePublishedEvent(e){var t;let r=(null===(t=this.collectPubkeyFromEvent)||void 0===t?void 0:t.call(this,e,void 0))||[];for(let e of r)this.enqueueBacklog(e)}captureRequestedFilter(e){var t;let r=(null===(t=this.collectPubkeyFromFilter)||void 0===t?void 0:t.call(this,e))||[];for(let e of r)this.enqueueBacklog(e)}captureReceivedEvent(e){var t;let r=(null===(t=this.collectPubkeyFromEvent)||void 0===t?void 0:t.call(this,e.received.event,e.relay.url))||[];for(let e of r)this.enqueueBacklog(e)}get(e){var t;if(!this.mux)throw Error("AutoProfileSubscriber is NOT installed");return this.cache.has(e)?Promise.resolve(null===(t=this.cache.get(e))||void 0===t?void 0:t.foundProfile):(this.enqueueBacklog(e),new Promise(t=>{this.waitingPromises[e]||(this.waitingPromises[e]=[]),this.waitingPromises[e].push(t)}))}evictCache(){this.cache.evict()}clearCache(){this.cache.clear()}enqueueBacklog(e){!(this.cache.has(e)||this.pubkeyBacklog.has(e))&&(this.pubkeyBacklog.add(e),this.activeTicker||(this.activeTicker=setTimeout(this.ticker,this.tickInterval)))}resolveWaitingPromises(e,t){let r=this.waitingPromises[e];if(r){for(let e of r)e(t);delete this.waitingPromises[e]}}finishTicker(){this.activeTicker=this.pubkeyBacklog.size>0?setTimeout(this.ticker,this.tickInterval):void 0}}p.$Q,p.Ps}}]);